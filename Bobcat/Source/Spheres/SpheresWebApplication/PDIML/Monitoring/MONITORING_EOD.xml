<?xml version="1.0" encoding="utf-8" ?>
<!--PM 20150602 [20575] Replace em.DTMARKET with em.DTENTITY and em.DTMARKETPREV with em.DTENTITYPREV-->
<Referentials>
  <Referential>
    <IsUseSQLParameters>true</IsUseSQLParameters>
    <TableName>MONITORING</TableName>
    <Ressource>MONITORING</Ressource>
    <ColumnByRow>4</ColumnByRow>
    <Create>false</Create>
    <Modify>false</Modify>
    <Remove>false</Remove>

    <SQLSelect>

      <Command rdbms = "all">
        <![CDATA[
        
        select em.IDA_ENTITY, a_entity.IDENTIFIER as ENTITY_IDENTIFIER, a_entity.DISPLAYNAME as ENTITY_DISPLAYNAME, 
        em.IDA_CSSCUSTODIAN, a_csscust.IDENTIFIER as CSSCUSTODIAN_IDENTIFIER,  a_csscust.DISPLAYNAME as CSSCUSTODIAN_DISPLAYNAME, 
        em.DTENTITY, isnull(pr.DTBUSINESS,em.DTENTITY) as DTBUSINESS, isnull(pr.STATUS, 'N/A') as STATUS, 
        isnull(pr.DTUPD, pr.DTINS) as DTSTATUS, pr.REQUESTTYPE, en.EXTVALUE as EXTENDVALUE_REQUESTTYPE
        from dbo.VW_ENTITY_CSSCUSTODIAN em
        inner join dbo.ACTOR a_entity on (a_entity.IDA=em.IDA_ENTITY)
        inner join dbo.ACTOR a_csscust on (a_csscust.IDA=em.IDA_CSSCUSTODIAN)
        left join (
  			  select max(pr.IDPR) as IDPR, pr.IDA_ENTITY, pr.IDA_CSSCUSTODIAN, pr.REQUESTTYPE
	  		  from dbo.VW_ENTITY_CSSCUSTODIAN em
          inner join dbo.POSREQUEST pr on (pr.IDA_ENTITY = em.IDA_ENTITY) and (pr.IDA_CSSCUSTODIAN = em.IDA_CSSCUSTODIAN) 
          and (pr.DTBUSINESS between em.DTENTITYPREV and em.DTENTITY)
			    where (pr.REQUESTTYPE in (@EOD,@CLOSINGDAY))
			    group by pr.IDA_ENTITY, pr.IDA_CSSCUSTODIAN, pr.REQUESTTYPE
		    ) prlast on (prlast.IDA_ENTITY = em.IDA_ENTITY) and (prlast.IDA_CSSCUSTODIAN = em.IDA_CSSCUSTODIAN) 
        left join dbo.POSREQUEST pr on (pr.IDPR = prlast.IDPR)
        left join dbo.ENUM en on (en.CODE = 'PosRequestTypeEnum') and (en.VALUE = pr.REQUESTTYPE)

        where (em.IDA_ENTITY=case when (@ENTITY=-1) then em.IDA_ENTITY else @ENTITY end) and 
              (em.CSSCUSTODIAN = case when (-2 < @CSSCUSTODIAN) then em.CSSCUSTODIAN else @CSSCUSTODIAN end) and
              (em.IDA_CSSCUSTODIAN = case when (-1 < @CSSCUSTODIAN) then @CSSCUSTODIAN else em.IDA_CSSCUSTODIAN end)
              
      ]]>
      </Command>
    </SQLSelect>

    <!-- ENTITY -->
    <Column>
      <ColumnName>IDA_ENTITY</ColumnName>
      <Ressource>Entity</Ressource>
      <DataType>int</DataType>
      <Nowrap>true</Nowrap>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy order="ENTITY_IDENTIFIER, CSSCUSTODIAN_IDENTIFIER, DTBUSINESS desc">true</IsOrderBy>
    </Column>

    <Column>
      <ColumnName>ENTITY_IDENTIFIER</ColumnName>
      <Ressource>IDA_ENTITY_2</Ressource>
      <DataType>string</DataType>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInCriteria>false</IsHideInCriteria>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsOrderBy>false</IsOrderBy>
    </Column>
    <Column>
      <ColumnName>ENTITY_DISPLAYNAME</ColumnName>
      <Ressource></Ressource>
      <DataType>string</DataType>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsOrderBy>false</IsOrderBy>
    </Column>
    <!-- CLEARING HOUSE -->
    <Column>
      <ColumnName>IDA_CSSCUSTODIAN</ColumnName>
      <Ressource>IDA_CSSCUSTODIAN</Ressource>
      <DataType>int</DataType>
      <Nowrap>true</Nowrap>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>

    <Column>
      <ColumnName>CSSCUSTODIAN_IDENTIFIER</ColumnName>
      <Ressource>CssCustodian2</Ressource>
      <DataType>string</DataType>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsOrderBy>false</IsOrderBy>
    </Column>

    <Column>
      <ColumnName>CSSCUSTODIAN_DISPLAYNAME</ColumnName>
      <Ressource></Ressource>
      <DataType>string</DataType>
      <GridWidth>-100</GridWidth>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsOrderBy>false</IsOrderBy>
    </Column>

    <Column>
      <ColumnName>REQUESTTYPE</ColumnName>
      <Ressource>VALUE_REQUESTTYPE</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>

    <Column>
      <ColumnName>DTENTITY</ColumnName>
      <Ressource>DTMARKET_</Ressource>
      <DataType>date</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>

    <Column>
      <ColumnName>EXTENDVALUE_REQUESTTYPE</ColumnName>
      <Ressource>Monitoring_RequestType</Ressource>
      <DataType>string</DataType>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInCriteria>false</IsHideInCriteria>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <IsResource>true</IsResource>
      <CellStyle type="class">
        <Otherwise>level</Otherwise>
      </CellStyle>
    </Column>

    <Column>
      <ColumnName>DTBUSINESS</ColumnName>
      <Ressource></Ressource>
      <DataType>date</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>

    <Column>
      <ColumnName>STATUS</ColumnName>
      <Ressource>Statut</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>

    <Column>
      <ColumnName>DTSTATUS</ColumnName>
      <Ressource></Ressource>
      <DataType datakind='Timestamp' tzdbid='Etc/UTC' display='Audit'>datetime</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>

  </Referential>
</Referentials>
