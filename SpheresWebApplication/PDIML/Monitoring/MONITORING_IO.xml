<?xml version="1.0" encoding="utf-8" ?>
<Referentials>
  <Referential>
    <IsUseSQLParameters>true</IsUseSQLParameters>
    <TableName>MONITORING</TableName>
    <Ressource>MONITORING</Ressource>
    <ColumnByRow>4</ColumnByRow>
    <Create>false</Create>
    <Modify>false</Modify>
    <Remove>false</Remove>

    <SQLSelect>
      <Command rdbms = "all">
        <![CDATA[
        
        select result.DISPLAYNAME as TASK, result.IN_OUT as IOTYPE, result.IO_DISPLAYNAME as TASKDET, 
        case when iotrack.IDIOTRACK is not null then iotrack.STATUSRETURN else tracker.STATUSTRACKER end as STATUS,
        case when iotrack.IDIOTRACK is not null then iotrack.DTINS else isnull(tracker.DTUPD, tracker.DTINS) end as DTSTATUS, 
        isnull(iotrack.DATA1,0) as DATA1, isnull(iotrack.DATA2,0) as DATA2, isnull(iotrack.DATA3,0) as DATA3, isnull(iotrack.DATA4,0) as DATA4, 
        isnull(iotrack.DATA5,0) as DATA5 
        from
        (
	        select task.IDIOTASK, task.IN_OUT, task.DISPLAYNAME, taskdet.IDIOTASKDET, io_in.DISPLAYNAME as IO_DISPLAYNAME, trkmax.IDTRK_L
	        from dbo.IOTASK task 
	        inner join dbo.IOTASKDET taskdet  on (taskdet.IDIOTASK = task.IDIOTASK) and (taskdet.ELEMENTTYPE = @INPUT) 
	        left join dbo.IOINPUT io_in       on (io_in.IDIOINPUT = taskdet.IDIOELEMENT)  
	        inner join dbo.EXTLID ex          on (ex.ID = task.IDIOTASK) and (ex.TABLENAME='IOTASK') and (ex.IDENTIFIER = 'IDMONITORINGWINDOW') and (ex.VALUE = 'Inputs')
	        inner join dbo.EXTLID ex2         on (ex2.ID = taskdet.IDIOTASKDET) and (ex2.TABLENAME='IOTASKDET') and (ex2.IDENTIFIER = 'ISMONITORED') and (ex2.VALUE='true')
	        left outer join 
		        ( 
			        select  max(IDTRK_L) as IDTRK_L, IDDATA
			        from dbo.TRACKER_L
			        where  GROUPTRACKER=@GROUPTRACKER 
			        group by IDDATA
		        ) trkmax  on  (trkmax.IDDATA = task.IDIOTASK)
          where (task.IN_OUT = @INPUT)
           
          union all
          
	        select task.IDIOTASK, task.IN_OUT, task.DISPLAYNAME, taskdet.IDIOTASKDET, io_out.DISPLAYNAME as IO_DISPLAYNAME, trkmax.IDTRK_L
	        from dbo.IOTASK task 
	        inner join dbo.IOTASKDET taskdet  on (taskdet.IDIOTASK = task.IDIOTASK) and (taskdet.ELEMENTTYPE = @OUTPUT) 
	        left join dbo.IOOUTPUT io_out     on (io_out.IDIOOUTPUT = taskdet.IDIOELEMENT) 
	        inner join dbo.EXTLID ex          on (ex.ID = task.IDIOTASK) and (ex.TABLENAME='IOTASK') and (ex.IDENTIFIER = 'IDMONITORINGWINDOW') and (ex.VALUE = 'Outputs')
	        inner join dbo.EXTLID ex2         on (ex2.ID = taskdet.IDIOTASKDET) and (ex2.TABLENAME='IOTASKDET') and (ex2.IDENTIFIER = 'ISMONITORED') and (ex2.VALUE='true')
	        left outer join 
		        ( 
			        select  max(IDTRK_L) as IDTRK_L, IDDATA
			        from dbo.TRACKER_L
			        where  GROUPTRACKER=@GROUPTRACKER 
			        group by IDDATA
		        ) trkmax  on  (trkmax.IDDATA = task.IDIOTASK)
           where (task.IN_OUT = @OUTPUT)
           
        ) result
        left outer join dbo.TRACKER_L tracker on (tracker.IDTRK_L = result.IDTRK_L)
        left outer join dbo.PROCESS_L procs on (procs.IDTRK_L = result.IDTRK_L) 
        left outer join dbo.IOTRACK iotrack on (iotrack.IDPROCESS_L = procs.IDPROCESS_L) and (iotrack.IDIOTASKDET = result.IDIOTASKDET) 
      ]]>
      </Command>
    </SQLSelect>
    
    <Column>
      <ColumnName>IOTYPE</ColumnName>
      <Ressource>IDIOTASK</Ressource>
      <DataType>string</DataType>
      <Nowrap>true</Nowrap>
      <Length>128</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy order="IOTYPE, TASK, TASKDET">true</IsOrderBy>
    </Column>

    <Column>
      <ColumnName>TASK</ColumnName>
      <Ressource></Ressource>
      <DataType>string</DataType>
      <Nowrap>true</Nowrap>
      <Length>128</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>

    <Column>
      <ColumnName>TASKDET</ColumnName>
      <Ressource>IDIOTASKDET</Ressource>
      <DataType>string</DataType>
      <GridWidth>-100</GridWidth>
      <Colspan>0</Colspan>
      <Length>128</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>

    <Column>
      <ColumnName>STATUS</ColumnName>
      <Ressource>Statut</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>

    <Column>
      <ColumnName>DTSTATUS</ColumnName>
      <Ressource></Ressource>
      <DataType datakind='Timestamp' tzdbid='Etc/UTC' display='Audit'>datetime</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>

    <Column>
      <ColumnName>DATA1</ColumnName>
      <Ressource>Monitoring_StatusLine1</Ressource>
      <DataType>int</DataType>
      <Align>right</Align>
      <GridWidth>70</GridWidth>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>

    <Column>
      <ColumnName>DATA2</ColumnName>
      <Ressource></Ressource>
      <DataType>int</DataType>
      <Align>right</Align>
      <GridWidth>70</GridWidth>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>DATA3</ColumnName>
      <Ressource>Monitoring_StatusLine2</Ressource>
      <DataType>int</DataType>
      <Align>right</Align>
      <GridWidth>70</GridWidth>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>DATA4</ColumnName>
      <Ressource></Ressource>
      <DataType>int</DataType>
      <Align>right</Align>
      <GridWidth>70</GridWidth>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>DATA5</ColumnName>
      <Ressource></Ressource>
      <DataType>int</DataType>
      <Align>right</Align>
      <GridWidth>70</GridWidth>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
  </Referential>
</Referentials>

