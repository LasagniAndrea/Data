<?xml version="1.0" encoding="utf-8" ?>
<!-- FI 20150107 [XXXXX] * sur ConditionApplication de SQLSELECT-->
<!-- CC 20120817 Replace view VW_EVENT_STL by VW_EVENT_ALL_STL                                                                           -->
<!-- Reminder:                                                                                                                           -->
<!-- VW_EVENT_STL    : used by 'Cash Flows (Payer/Receiver)' consultation to display cash flows on GPRODUCT FX, OTC and SEC              -->
<!-- VW_EVENT_ALL_STL: used by C.Flows button available from input trade to display cash flows on all GPRODUCT except ADM,ASSET and RISK -->

<!--FI 20120104
Consultation des CashFlows 
Cette consultation est affiche uniquement des trades de Marché
La vue VW_EVENT_STL exclue les produits telsque GPRODUCT in ('ADM', 'ASSET','RISK')-->

<!-- FI 20120104 [] mise en place des mots clefs %%SR, la requête est de type rdbms = "all" -->

<Referentials>
  <Referential>
    <TableName>VW_EVENT_ALL_STL</TableName>
    <Ressource>VW_EVENT_ALL_STL</Ressource>
    <ColumnByRow>3</ColumnByRow>
    <Create>false</Create>
    <Modify>false</Modify>
    <Remove>false</Remove>
    <Image></Image>
    
    <SQLSelect>
      <ConditionApplication>*</ConditionApplication>
      <Command rdbms = "all">
        <![CDATA[
          select
          e_stl.IDENTIFIER as E_STL_IDENTIFIER,e_stl.IDT as E_STL_IDT,
          e_stl.STREAMNO as E_STL_STREAMNO,
          e_stl.DTSTARTADJ as E_STL_DTSTARTADJ,e_stl.DTSTARTUNADJ as E_STL_DTSTARTUNADJ,e_stl.DTENDADJ as E_STL_DTENDADJ,e_stl.DTENDUNADJ as E_STL_DTENDUNADJ,
          e_stl.IDE as E_STL_IDE,e_stl.IDE_EVENT as E_STL_IDE_EVENT,
          e_stl.EVTCLASS_DESCRIPTION as E_STL_EVTCLASS_DESCRIPTION,e_stl.EVENTCODE as E_STL_EVENTCODE, e_stl.EVTCODE_DESCRIPTION as E_STL_EVTCODE_DESCRIPTION,e_stl.EVTTYPE_DESCRIPTION as E_STL_EVTTYPE_DESCRIPTION, 
          a_pay.IDENTIFIER as PAYER_IDENTIFIER, a_rec.IDENTIFIER as RECEIVER_IDENTIFIER, 
          e_stl.VALORISATION as E_STL_VALORISATION,e_stl.UNIT as E_STL_UNIT,e_stl.RATE as E_STL_RATE,e_stl.ASSET as E_STL_ASSET,
          e_stl.DTEVENT as E_STL_DTEVENT,e_stl.DTEVENTFORCED as E_STL_DTEVENTFORCED,
          ec.DTEVENT as E_REC_DTEVENT
          from dbo.VW_EVENT_ALL_STL e_stl
          inner join dbo.EVENTCLASS ec on ec.IDE=e_stl.IDE and ec.EVENTCLASS='REC'
          inner join dbo.ACTOR a_pay on a_pay.IDA= e_stl.IDA_PAY
          inner join dbo.ACTOR a_rec on a_rec.IDA= e_stl.IDA_REC
          %%SR:TRADE_JOIN%%(e_stl.IDT)
          where 
          %%SR:TRADE_WHERE_PREDICATE%%
      ]]>
      </Command>
    </SQLSelect>
    
    <SQLWhere>
      <ConditionApplication>TRADE_CONSUL</ConditionApplication>
      <SQLWhere>(tblmain.E_STL_IDT=%%DA:IDT.GetDataSQLValue()%%)</SQLWhere>
    </SQLWhere>
   
    <SQLRowStyle type="style">
      <![CDATA[
      case when (E_STL_DTEVENT = getdate())
           then 'font-weight:bold;background-color:pink;'
           else case when (getdate() between E_STL_DTSTARTADJ and E_STL_DTENDADJ-1)
                     then 'font-weight:bold;background-color:darkseagreen;'
                     else case when mod(E_STL_STREAMNO,2) = 0
                               then case when E_STL_EVENTCODE='TER'
                                         then 'background-color:lightsteelblue;'
                                         else 'background-color:lavender;'
                                         end
                               else case when E_STL_EVENTCODE='TER'
                                         then 'background-color:beige;'
                                         else 'background-color:white;'
                                         end
                               end
                     end
            end
      ]]>
    </SQLRowStyle>
    <SQLRowState>
      <![CDATA[
      case when E_STL_DTEVENT < getdate()
           then case when E_STL_VALORISATION is null
                     then 'lstaw=name:ledrose;title:... '
                     else 'lstaw=name:ledblue;title:... '
                     end
           else case when E_STL_DTEVENT = getdate()
                     then case when E_STL_VALORISATION is null
                               then 'lstaw=name:ledred;title:... '
                               else 'lstaw=name:ledorange;title:... '
                           end
                     else 'lstaw=name:ledgray;title:... '
                     end
            end     
      || '+' ||
      case when E_STL_VALORISATION is null
           then 'lstaw=name:false;title:... '
           else 'lstaw=name:true;title:... '
           end     
      || '+' ||
      case when (getdate() between E_STL_DTSTARTADJ and E_STL_DTENDADJ-1) or (E_STL_DTEVENT = getdate())
           then 'lstaw=name:calendar;title:Current '
           else case when E_STL_EVENTCODE='TER'
                     then 'lstaw=name:terminationprovisiondisable;title:Termination '
                     else ''
                     end
           end     
      ]]>
    </SQLRowState>

    <Column>
      <ColumnName>E_STL_IDT</ColumnName>
      <Ressource>IDT</Ressource>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>true</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <!--IsOrderBy order="E_STL_STREAMNO, E_STL_DTSTARTUNADJ">true</IsOrderBy-->
      <IsOrderBy order="E_STL_DTEVENT, E_STL_IDE">true</IsOrderBy>
    </Column>
    <Column>
      <ColumnName>E_STL_IDENTIFIER</ColumnName>
      <Ressource>IDENTIFIER</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <Relation>
      </Relation>
      <html_HR></html_HR>
    </Column>
    <Column>
      <ColumnName>E_STL_STREAMNO</ColumnName>
      <Ressource>COL_STREAMNO</Ressource>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <!-- CC 20110915 HideInDataGrid to true GLOP -->
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>E_STL_IDE</ColumnName>
      <Ressource>COL_IDE</Ressource>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>E_REC_DTEVENT</ColumnName>
      <Ressource>COL_DTEVENT_REC</Ressource>
      <DataType>date</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>E_STL_DTEVENT</ColumnName>
      <Ressource>COL_DTEVENT_STL</Ressource>
      <DataType>date</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsVirtualColumn>true</IsVirtualColumn>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>E_STL_DTEVENTFORCED</ColumnName>
      <Ressource>COL_DTEVENTFORCED_STL</Ressource>
      <DataType>date</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsVirtualColumn>true</IsVirtualColumn>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>E_STL_EVTTYPE_DESCRIPTION</ColumnName>
      <Ressource>COL_EVENTTYPE_</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>E_STL_EVTCLASS_DESCRIPTION</ColumnName>
      <Ressource>COL_EVENTCLASS</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>PAYER_IDENTIFIER</ColumnName>
      <Ressource>COL_PAYER_IDENTIFIER</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
      <CellStyle type="style">
        <When test="!=">color:#C00303;font-weight:bold;</When>
      </CellStyle>
    </Column>
    <Column>
      <ColumnName>RECEIVER_IDENTIFIER</ColumnName>
      <Ressource>COL_RECEIVER_IDENTIFIER</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
      <CellStyle type="style">
				<When test="!=">color:#51AD26;font-weight:bold;</When>
			</CellStyle>
    </Column>
    <Column>
      <ColumnName>E_STL_VALORISATION</ColumnName>
      <Ressource>COL_VALORISATION_CASHFLOWS</Ressource>
      <DataType>dec</DataType>
      <Length>26</Length>
      <Scale>2</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
      <CellStyle type="style">
        <When test="!=">font-weight:bold;</When>
      </CellStyle>
    </Column>
    <Column>
      <ColumnName>E_STL_UNIT</ColumnName>
      <Ressource></Ressource>
      <DataType>string</DataType>
      <Length>3</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
      <CellStyle type="style">
        <When test="!=">font-weight:bold;</When>
      </CellStyle>
    </Column>
    <Column>
      <ColumnName>E_STL_RATE</ColumnName>
      <Ressource>COL_RATE</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <!-- CC 20110915 HideInDataGrid to true GLOP -->
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>E_STL_ASSET</ColumnName>
      <Ressource>COL_ASSET</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <!-- CC 20110915 HideInDataGrid to true GLOP -->
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>E_STL_DTSTARTUNADJ</ColumnName>
      <Ressource>COL_PERIODUNADJ</Ressource>
      <DataType>date</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <!-- CC 20110915 HideInDataGrid to true GLOP -->
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>E_STL_DTENDUNADJ</ColumnName>
      <Ressource></Ressource>
      <DataType>date</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <!-- CC 20110915 HideInDataGrid to true GLOP -->
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
    </Column>
    <!--<Column>
      <ColumnName>E_STL_DTSTARTADJ</ColumnName>
      <Ressource>COL_PERIODADJ</Ressource>
      <DataType>date</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      --><!-- CC 20110915 HideInDataGrid to true GLOP --><!--
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
    </Column>-->
    <Column>
      <ColumnName>E_STL_DTENDADJ</ColumnName>
      <Ressource></Ressource>
      <DataType>date</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <!-- CC 20110915 HideInDataGrid to true GLOP -->
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>E_STL_EVENTCODE</ColumnName>
      <Ressource>COL_EVENTCODE_</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>E_STL_EVTCODE_DESCRIPTION</ColumnName>
      <Ressource>COL_EVENTCODE_</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
    </Column>



  </Referential>
</Referentials>