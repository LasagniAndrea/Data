<?xml version="1.0" encoding="utf-8" ?>
<Referentials>
  <Referential>
    <TableName>FEEACTOR</TableName>
    <Ressource>FEEACTOR</Ressource>
    <freezeColumn>3</freezeColumn>
    <TargetName>FEEMATRIX</TargetName>
    <ColumnByRow>3</ColumnByRow>
    <Create>false</Create>
    <Modify>false</Modify>
    <Remove>false</Remove>
    <LoadOnStart>false</LoadOnStart>
    <Image></Image>

    <SQLSelect>
      <Command rdbms ="all">
        <![CDATA[
          /* First select to obtain applicable fees paid by the actor */
          select 
          distinct a.IDA,  
          /* General informations of Conditions */
          fm.IDFEEMATRIX, fm.IDENTIFIER as FEEMATRIX_IDENTIFIER, fm.DISPLAYNAME as FEEMATRIX_DISPLAYNAME,
          'Payer' as FEEPAYERORRECEIVER,
          fm.IDPARTYA,fm.FEETYPEPARTYA,fm.IDROLEACTOR_PARTYA,  
          fm.ACTION,  
          /* Environment Context of Conditions */
          fm.IDSTBUSINESS,
          fm.GPRODUCT,fm.TYPEINSTR as FEEMATRIX_TYPEINSTR,fm.IDINSTR as FEEMATRIX_IDINSTR,
          fm.TYPECONTRACT as FEEMATRIX_TYPECONTRACT,fm.IDCONTRACT as FEEMATRIX_IDCONTRACT,
          fm.TYPECONTRACTEXCEPT as FEEMATRIX_TYPECONTRACTEXCEPT,fm.IDCONTRACTEXCEPT as FEEMATRIX_IDCONTRACTEXCEPT,
          fm.TYPEINSTR_UNL as FEEMATRIX_TYPEINSTR_UNL,fm.IDINSTR_UNL as FEEMATRIX_IDINSTR_UNL,fm.ASSETCATEGORY,
          fm.IDC as FEEMATRIX_IDC, 
          case when fm.ISEXCLUDEIDC=1 then 'DifferentCurrency' else 'SameCurrency'
          end as FEEMATRIX_ISEXCLUDEIDC,  
          /* Details of Conditions */
          fm.TAXAPPLICATION,fm.ISINVOICING,  
          fm.DTENABLED, fm.DTDISABLED,
          /* General informations of Schedule */
          fs.IDFEE, fs.IDFEESCHEDULE, fs.DISPLAYNAME,  
          fs.FEESCOPE,
          /* Details of Schedule */
          fs.IDC, fs.IDC_FEE1,
          case when fs.IDA is null then 'Standard' else 'Override' end as SCHEDULECLASS
          from dbo.ACTOR a
          cross join dbo.FEEMATRIX fm
          --left outer join dbo.VW_BOOK_VIEWER b on b.FK=a.IDA and (b.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (b.DTDISABLED is null or b.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          left outer join dbo.VW_BOOK_VIEWER b on b.FK=a.IDA and (b.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(b.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          inner join dbo.FEESCHEDULE fs_key on fs_key.IDFEESCHEDULE=fm.IDFEESCHEDULE_DEPRECATED 
          --inner join dbo.FEESCHEDULE fs on fs.IDENTIFIER=fs_key.IDENTIFIER and (fs.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (fs.DTDISABLED is null or fs.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          inner join dbo.FEESCHEDULE fs on fs.IDENTIFIER=fs_key.IDENTIFIER and fs.IDFEE=fm.IDFEE
                                        and (fs.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(fs.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          --left outer join dbo.ACTORROLE ar on ar.IDA=a.IDA and (ar.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (ar.DTDISABLED is null or ar.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          left outer join dbo.ACTORROLE ar on ar.IDA=a.IDA and (ar.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(ar.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          --left outer join dbo.ACTORG ag on ag.IDA=a.IDA and (ag.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (ag.DTDISABLED is null or ag.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          left outer join dbo.ACTORG ag on ag.IDA=a.IDA and (ag.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(ag.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          --left outer join dbo.GACTORROLE gar on gar.IDGACTOR=ag.IDGACTOR and gar.IDROLEGACTOR='FEE' and (gar.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gar.DTDISABLED is null or gar.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          left outer join dbo.GACTORROLE gar on gar.IDGACTOR=ag.IDGACTOR and gar.IDROLEGACTOR='FEE' and (gar.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gar.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          --left outer join dbo.GACTOR ga on ga.IDGACTOR=ag.IDGACTOR and (ga.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (ga.DTDISABLED is null or ga.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          left outer join dbo.GACTOR ga on ga.IDGACTOR=ag.IDGACTOR and (ga.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(ga.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          --left outer join dbo.BOOKG bg on bg.IDB=b.IDB and (bg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (bg.DTDISABLED is null or bg.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          left outer join dbo.BOOKG bg on bg.IDB=b.IDB and (bg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(bg.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          --left outer join dbo.GBOOKROLE gbr on gbr.IDGBOOK=bg.IDGBOOK and gbr.IDROLEGBOOK='FEE' and (gbr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gbr.DTDISABLED is null or gbr.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          left outer join dbo.GBOOKROLE gbr on gbr.IDGBOOK=bg.IDGBOOK and gbr.IDROLEGBOOK='FEE' and (gbr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gbr.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          --left outer join dbo.GBOOK gb on gb.IDGBOOK=bg.IDGBOOK and (gb.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gb.DTDISABLED is null or gb.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          left outer join dbo.GBOOK gb on gb.IDGBOOK=bg.IDGBOOK and (gb.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gb.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          
          --where (fm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (fm.DTDISABLED is null or fm.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          where (fm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(fm.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          and
          (
              /* ******************************** */
              /* Specific schedule fot this actor */
              /* ******************************** */
              (
                  fs.IDA=a.IDA
                  and
                  (
                    /* Actor */ 
                    (fm.FEEPAYER='PartyA' and fm.FEETYPEPARTYA='Actor' and fm.IDPARTYA=a.IDA)
                    or (fm.FEEPAYER='PartyB' and fm.FEETYPEPARTYB='Actor' and fm.IDPARTYB=a.IDA)
                    or (fm.FEEPAYER='OtherParty1' and fm.FEETYPEOTHERPARTY1='Actor' and fm.IDOTHERPARTY1=a.IDA)
                    or (fm.FEEPAYER='OtherParty2' and fm.FEETYPEOTHERPARTY2='Actor' and fm.IDOTHERPARTY2=a.IDA)
                    -- Book --------------------------------
                    or (fm.FEEPAYER='PartyA' and fm.FEETYPEPARTYA='Book' and fm.IDPARTYA=b.IDB)
                    or (fm.FEEPAYER='PartyB' and fm.FEETYPEPARTYB='Book' and fm.IDPARTYB=b.IDB)			
                    -- Actors Group ------------------------
                    or (fm.FEEPAYER='PartyA' and fm.FEETYPEPARTYA='GrpActor' and fm.IDPARTYA=ag.IDGACTOR and gar.IDGACTOR is not null and ga.IDGACTOR is not null)
                    or (fm.FEEPAYER='PartyB' and fm.FEETYPEPARTYB='GrpActor' and fm.IDPARTYB=ag.IDGACTOR and gar.IDGACTOR is not null and ga.IDGACTOR is not null)
                    or (fm.FEEPAYER='OtherParty1' and fm.FEETYPEOTHERPARTY1='GrpActor' and fm.IDOTHERPARTY1=ag.IDGACTOR and gar.IDGACTOR is not null and ga.IDGACTOR is not null)
                    or (fm.FEEPAYER='OtherParty2' and fm.FEETYPEOTHERPARTY2='GrpActor' and fm.IDOTHERPARTY2=ag.IDGACTOR and gar.IDGACTOR is not null and ga.IDGACTOR is not null)
                    -- Books Group -------------------------
                    or (fm.FEEPAYER='PartyA' and fm.FEETYPEPARTYA='GrpBook' and fm.IDPARTYA=bg.IDGBOOK and gbr.IDGBOOK is not null and gb.IDGBOOK is not null)
                    or (fm.FEEPAYER='PartyB' and fm.FEETYPEPARTYB='GrpBook' and fm.IDPARTYB=bg.IDGBOOK and gbr.IDGBOOK is not null and gb.IDGBOOK is not null)
                    -- All ---------------------------------
                    or (fm.FEEPAYER='PartyA' and fm.FEETYPEPARTYA='All' and (fm.IDROLEACTOR_PARTYA=ar.IDROLEACTOR or fm.IDROLEACTOR_PARTYA is null))
                    or (fm.FEEPAYER='PartyB' and fm.FEETYPEPARTYB='All' and (fm.IDROLEACTOR_PARTYB=ar.IDROLEACTOR or fm.IDROLEACTOR_PARTYB is null))
                    or (fm.FEEPAYER='OtherParty1' and fm.FEETYPEOTHERPARTY1='All' and (fm.IDROLEACTOR_OPART1=ar.IDROLEACTOR or fm.IDROLEACTOR_OPART1 is null))
                    or (fm.FEEPAYER='OtherParty2' and fm.FEETYPEOTHERPARTY2='All' and (fm.IDROLEACTOR_OPART2=ar.IDROLEACTOR or fm.IDROLEACTOR_OPART2 is null))
                    -- ClearingHouse -----------------------
                    or (fm.FEEPAYER='ClearingHouse' and ar.IDROLEACTOR='CSS')
                  )
              )
              or
              /* ******************************** */
              /* Standard schedule                */ 
              /* ******************************** */
              (
                  fs.IDA is null and not exists (select 1 from dbo.FEESCHEDULE fs_sub where fs_sub.IDENTIFIER=fs.IDENTIFIER and fs_sub.IDA=a.IDA)
                  and 
                  (
                    /* Actor */ 
                    (fm.FEEPAYER='PartyA' and fm.FEETYPEPARTYA='Actor' and fm.IDPARTYA=a.IDA)
                    or (fm.FEEPAYER='PartyB' and fm.FEETYPEPARTYB='Actor' and fm.IDPARTYB=a.IDA)
                    or (fm.FEEPAYER='OtherParty1' and fm.FEETYPEOTHERPARTY1='Actor' and fm.IDOTHERPARTY1=a.IDA)
                    or (fm.FEEPAYER='OtherParty2' and fm.FEETYPEOTHERPARTY2='Actor' and fm.IDOTHERPARTY2=a.IDA)
                    -- Book --------------------------------
                    or (fm.FEEPAYER='PartyA' and fm.FEETYPEPARTYA='Book' and fm.IDPARTYA=b.IDB)
                    or (fm.FEEPAYER='PartyB' and fm.FEETYPEPARTYB='Book' and fm.IDPARTYB=b.IDB)			
                    -- Actors Group ------------------------
                    or (fm.FEEPAYER='PartyA' and fm.FEETYPEPARTYA='GrpActor' and fm.IDPARTYA=ag.IDGACTOR and gar.IDGACTOR is not null and ga.IDGACTOR is not null)
                    or (fm.FEEPAYER='PartyB' and fm.FEETYPEPARTYB='GrpActor' and fm.IDPARTYB=ag.IDGACTOR and gar.IDGACTOR is not null and ga.IDGACTOR is not null)
                    or (fm.FEEPAYER='OtherParty1' and fm.FEETYPEOTHERPARTY1='GrpActor' and fm.IDOTHERPARTY1=ag.IDGACTOR and gar.IDGACTOR is not null and ga.IDGACTOR is not null)
                    or (fm.FEEPAYER='OtherParty2' and fm.FEETYPEOTHERPARTY2='GrpActor' and fm.IDOTHERPARTY2=ag.IDGACTOR and gar.IDGACTOR is not null and ga.IDGACTOR is not null)
                    -- Books Group -------------------------
                    or (fm.FEEPAYER='PartyA' and fm.FEETYPEPARTYA='GrpBook' and fm.IDPARTYA=bg.IDGBOOK and gbr.IDGBOOK is not null and gb.IDGBOOK is not null)
                    or (fm.FEEPAYER='PartyB' and fm.FEETYPEPARTYB='GrpBook' and fm.IDPARTYB=bg.IDGBOOK and gbr.IDGBOOK is not null and gb.IDGBOOK is not null)
                    -- All ---------------------------------
                    or (fm.FEEPAYER='PartyA' and fm.FEETYPEPARTYA='All' and (fm.IDROLEACTOR_PARTYA=ar.IDROLEACTOR or fm.IDROLEACTOR_PARTYA is null))
                    or (fm.FEEPAYER='PartyB' and fm.FEETYPEPARTYB='All' and (fm.IDROLEACTOR_PARTYB=ar.IDROLEACTOR or fm.IDROLEACTOR_PARTYB is null))
                    or (fm.FEEPAYER='OtherParty1' and fm.FEETYPEOTHERPARTY1='All' and (fm.IDROLEACTOR_OPART1=ar.IDROLEACTOR or fm.IDROLEACTOR_OPART1 is null))
                    or (fm.FEEPAYER='OtherParty2' and fm.FEETYPEOTHERPARTY2='All' and (fm.IDROLEACTOR_OPART2=ar.IDROLEACTOR or fm.IDROLEACTOR_OPART2 is null))
                    -- ClearingHouse -----------------------
                    or (fm.FEEPAYER='ClearingHouse' and ar.IDROLEACTOR='CSS')
                  )
              )
          )
          and 
          /* ************************************************************ */
          /* 20111216                                                     */
          /* Market and GrpMarket restrict if ClearingHouse               */
          /* TBD Contract and GrpContract restrict if ClearingHouse       */
          /* ************************************************************ */
          (
             (fm.FEEPAYER!='ClearingHouse') 
			       or
			       (
              (
                (
                  (fs.TYPECONTRACT='Market' and fs.IDCONTRACT in (select IDM from dbo.MARKET where MARKET.IDA=a.IDA))
                   or
                  (fs.TYPECONTRACT='GrpMarket' and fs.IDCONTRACT in (
                    select MARKET.IDM 
                    from dbo.MARKET
                    --left outer join dbo.MARKETG mg on mg.IDM=MARKET.IDM and (mg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (mg.DTDISABLED is null or mg.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.MARKETG mg on mg.IDM=MARKET.IDM and (mg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(mg.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    --left outer join dbo.GMARKETROLE gmr on gmr.IDGMARKET=mg.IDGMARKET and gmr.IDROLEGMARKET='FEE' and (gmr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gmr.DTDISABLED is null or gmr.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.GMARKETROLE gmr on gmr.IDGMARKET=mg.IDGMARKET and gmr.IDROLEGMARKET='FEE' and (gmr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gmr.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    --left outer join dbo.GMARKET gm on gm.IDGMARKET=mg.IDGMARKET and (gm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gm.DTDISABLED is null or gm.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.GMARKET gm on gm.IDGMARKET=mg.IDGMARKET and (gm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gm.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    where MARKET.IDA=a.IDA)
                  )
                )
                and 
                (
                  (fm.TYPECONTRACT='Market' and fm.IDCONTRACT in (select IDM from dbo.MARKET where MARKET.IDA=a.IDA))
                   or
                  (fs.TYPECONTRACT='GrpMarket' and fs.IDCONTRACT in (
                    select MARKET.IDM 
                    from dbo.MARKET
                    --left outer join dbo.MARKETG mg on mg.IDM=MARKET.IDM and (mg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (mg.DTDISABLED is null or mg.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.MARKETG mg on mg.IDM=MARKET.IDM and (mg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(mg.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    --left outer join dbo.GMARKETROLE gmr on gmr.IDGMARKET=mg.IDGMARKET and gmr.IDROLEGMARKET='FEE' and (gmr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gmr.DTDISABLED is null or gmr.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.GMARKETROLE gmr on gmr.IDGMARKET=mg.IDGMARKET and gmr.IDROLEGMARKET='FEE' and (gmr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gmr.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    --left outer join dbo.GMARKET gm on gm.IDGMARKET=mg.IDGMARKET and (gm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gm.DTDISABLED is null or gm.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.GMARKET gm on gm.IDGMARKET=mg.IDGMARKET and (gm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gm.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    where MARKET.IDA=a.IDA)
                  )
                )
              )
              or
              (
                (
                  (fs.TYPECONTRACT='Market' and fs.IDCONTRACT in (select IDM from dbo.MARKET where MARKET.IDA=a.IDA))
                   or
                  (fs.TYPECONTRACT='GrpMarket' and fs.IDCONTRACT in (
                    select MARKET.IDM 
                    from dbo.MARKET
                    --left outer join dbo.MARKETG mg on mg.IDM=MARKET.IDM and (mg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (mg.DTDISABLED is null or mg.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.MARKETG mg on mg.IDM=MARKET.IDM and (mg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(mg.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    --left outer join dbo.GMARKETROLE gmr on gmr.IDGMARKET=mg.IDGMARKET and gmr.IDROLEGMARKET='FEE' and (gmr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gmr.DTDISABLED is null or gmr.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.GMARKETROLE gmr on gmr.IDGMARKET=mg.IDGMARKET and gmr.IDROLEGMARKET='FEE' and (gmr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gmr.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    --left outer join dbo.GMARKET gm on gm.IDGMARKET=mg.IDGMARKET and (gm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gm.DTDISABLED is null or gm.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.GMARKET gm on gm.IDGMARKET=mg.IDGMARKET and (gm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gm.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    where MARKET.IDA=a.IDA)
                  )
                )
                and 
                (fm.TYPECONTRACT is null)
              )
              or                     
              (
                (fs.TYPECONTRACT is null)
                and
                (
                  (fm.TYPECONTRACT='Market' and fm.IDCONTRACT in (select IDM from dbo.MARKET where MARKET.IDA=a.IDA))
                   or
                  (fm.TYPECONTRACT='GrpMarket' and fm.IDCONTRACT in (
                    select MARKET.IDM 
                    from dbo.MARKET
                    --left outer join dbo.MARKETG mg on mg.IDM=MARKET.IDM and (mg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (mg.DTDISABLED is null or mg.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.MARKETG mg on mg.IDM=MARKET.IDM and (mg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(mg.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    --left outer join dbo.GMARKETROLE gmr on gmr.IDGMARKET=mg.IDGMARKET and gmr.IDROLEGMARKET='FEE' and (gmr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gmr.DTDISABLED is null or gmr.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.GMARKETROLE gmr on gmr.IDGMARKET=mg.IDGMARKET and gmr.IDROLEGMARKET='FEE' and (gmr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gmr.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    --left outer join dbo.GMARKET gm on gm.IDGMARKET=mg.IDGMARKET and (gm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gm.DTDISABLED is null or gm.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.GMARKET gm on gm.IDGMARKET=mg.IDGMARKET and (gm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gm.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    where MARKET.IDA=a.IDA)
                  )
                )
              )
              or 
              (
                (fs.TYPECONTRACT is null)
                and
                (fm.TYPECONTRACT is null)
              )
			      )
	      )
        /* *************************************************************** */
        union all /* ***************************************************** */
        /* *************************************************************** */
        /* Second select to obtain applicable fees received by the actor */
        /* Selected columns identical to the first select */
        select 
          distinct a.IDA,  
          /* General informations of Conditions */
          fm.IDFEEMATRIX, fm.IDENTIFIER as FEEMATRIX_IDENTIFIER, fm.DISPLAYNAME as FEEMATRIX_DISPLAYNAME,
          'Beneficiary' as FEEPAYERORRECEIVER,
          fm.IDPARTYA,fm.FEETYPEPARTYA,fm.IDROLEACTOR_PARTYA,  
          fm.ACTION,  
          /* Environment Context of Conditions */
          fm.IDSTBUSINESS,
          fm.GPRODUCT,fm.TYPEINSTR as FEEMATRIX_TYPEINSTR,fm.IDINSTR as FEEMATRIX_IDINSTR,
          fm.TYPECONTRACT as FEEMATRIX_TYPECONTRACT,fm.IDCONTRACT as FEEMATRIX_IDCONTRACT,
          fm.TYPECONTRACTEXCEPT as FEEMATRIX_TYPECONTRACTEXCEPT,fm.IDCONTRACTEXCEPT as FEEMATRIX_IDCONTRACTEXCEPT,
          fm.TYPEINSTR_UNL as FEEMATRIX_TYPEINSTR_UNL,fm.IDINSTR_UNL as FEEMATRIX_IDINSTR_UNL,fm.ASSETCATEGORY,
          fm.IDC as FEEMATRIX_IDC, 
          case when fm.ISEXCLUDEIDC=1 then 'DifferentCurrency' else 'SameCurrency'
          end as FEEMATRIX_ISEXCLUDEIDC,  
          /* Details of Conditions */
          fm.TAXAPPLICATION,fm.ISINVOICING,  
          fm.DTENABLED, fm.DTDISABLED,
          /* General informations of Schedule */
          fs.IDFEE, fs.IDFEESCHEDULE, fs.DISPLAYNAME,  
          fs.FEESCOPE,
          /* Details of Schedule */
          fs.IDC, fs.IDC_FEE1,
          case when fs.IDA is null then 'Standard' else 'Override' end as SCHEDULECLASS
          from dbo.ACTOR a
          cross join dbo.FEEMATRIX fm
          --left outer join dbo.VW_BOOK_VIEWER b on b.FK=a.IDA and (b.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (b.DTDISABLED is null or b.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          left outer join dbo.VW_BOOK_VIEWER b on b.FK=a.IDA and (b.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(b.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          inner join dbo.FEESCHEDULE fs_key on fs_key.IDFEESCHEDULE=fm.IDFEESCHEDULE_DEPRECATED 
          --inner join dbo.FEESCHEDULE fs on fs.IDENTIFIER=fs_key.IDENTIFIER and (fs.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (fs.DTDISABLED is null or fs.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          inner join dbo.FEESCHEDULE fs on fs.IDENTIFIER=fs_key.IDENTIFIER and fs.IDFEE=fm.IDFEE
                                        and (fs.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(fs.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          --left outer join dbo.ACTORROLE ar on ar.IDA=a.IDA and (ar.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (ar.DTDISABLED is null or ar.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          left outer join dbo.ACTORROLE ar on ar.IDA=a.IDA and (ar.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(ar.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          --left outer join dbo.ACTORG ag on ag.IDA=a.IDA and (ag.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (ag.DTDISABLED is null or ag.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          left outer join dbo.ACTORG ag on ag.IDA=a.IDA and (ag.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(ag.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          --left outer join dbo.GACTORROLE gar on gar.IDGACTOR=ag.IDGACTOR and gar.IDROLEGACTOR='FEE' and (gar.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gar.DTDISABLED is null or gar.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          left outer join dbo.GACTORROLE gar on gar.IDGACTOR=ag.IDGACTOR and gar.IDROLEGACTOR='FEE' and (gar.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gar.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          --left outer join dbo.GACTOR ga on ga.IDGACTOR=ag.IDGACTOR and (ga.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (ga.DTDISABLED is null or ga.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          left outer join dbo.GACTOR ga on ga.IDGACTOR=ag.IDGACTOR and (ga.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(ga.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          --left outer join dbo.BOOKG bg on bg.IDB=b.IDB and (bg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (bg.DTDISABLED is null or bg.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          left outer join dbo.BOOKG bg on bg.IDB=b.IDB and (bg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(bg.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          --left outer join dbo.GBOOKROLE gbr on gbr.IDGBOOK=bg.IDGBOOK and gbr.IDROLEGBOOK='FEE' and (gbr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gbr.DTDISABLED is null or gbr.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          left outer join dbo.GBOOKROLE gbr on gbr.IDGBOOK=bg.IDGBOOK and gbr.IDROLEGBOOK='FEE' and (gbr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gbr.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          --left outer join dbo.GBOOK gb on gb.IDGBOOK=bg.IDGBOOK and (gb.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gb.DTDISABLED is null or gb.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          left outer join dbo.GBOOK gb on gb.IDGBOOK=bg.IDGBOOK and (gb.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gb.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          
          --where (fm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (fm.DTDISABLED is null or fm.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
          where (fm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(fm.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
          and
          (
              /* ******************************** */
              /* Specific schedule fot this actor */
              /* ******************************** */
              (
                  fs.IDA=a.IDA
                  and
                  (
                    /* Actor */ 
                    (fm.FEERECEIVER='PartyA' and fm.FEETYPEPARTYA='Actor' and fm.IDPARTYA=a.IDA)
                    or (fm.FEERECEIVER='PartyB' and fm.FEETYPEPARTYB='Actor' and fm.IDPARTYB=a.IDA)
                    or (fm.FEERECEIVER='OtherParty1' and fm.FEETYPEOTHERPARTY1='Actor' and fm.IDOTHERPARTY1=a.IDA)
                    or (fm.FEERECEIVER='OtherParty2' and fm.FEETYPEOTHERPARTY2='Actor' and fm.IDOTHERPARTY2=a.IDA)
                    -- Book --------------------------------
                    or (fm.FEERECEIVER='PartyA' and fm.FEETYPEPARTYA='Book' and fm.IDPARTYA=b.IDB)
                    or (fm.FEERECEIVER='PartyB' and fm.FEETYPEPARTYB='Book' and fm.IDPARTYB=b.IDB)			
                    -- Actors Group ------------------------
                    or (fm.FEERECEIVER='PartyA' and fm.FEETYPEPARTYA='GrpActor' and fm.IDPARTYA=ag.IDGACTOR and gar.IDGACTOR is not null and ga.IDGACTOR is not null)
                    or (fm.FEERECEIVER='PartyB' and fm.FEETYPEPARTYB='GrpActor' and fm.IDPARTYB=ag.IDGACTOR and gar.IDGACTOR is not null and ga.IDGACTOR is not null)
                    or (fm.FEERECEIVER='OtherParty1' and fm.FEETYPEOTHERPARTY1='GrpActor' and fm.IDOTHERPARTY1=ag.IDGACTOR and gar.IDGACTOR is not null and ga.IDGACTOR is not null)
                    or (fm.FEERECEIVER='OtherParty2' and fm.FEETYPEOTHERPARTY2='GrpActor' and fm.IDOTHERPARTY2=ag.IDGACTOR and gar.IDGACTOR is not null and ga.IDGACTOR is not null)
                    -- Books Group -------------------------
                    or (fm.FEERECEIVER='PartyA' and fm.FEETYPEPARTYA='GrpBook' and fm.IDPARTYA=bg.IDGBOOK and gbr.IDGBOOK is not null and gb.IDGBOOK is not null)
                    or (fm.FEERECEIVER='PartyB' and fm.FEETYPEPARTYB='GrpBook' and fm.IDPARTYB=bg.IDGBOOK and gbr.IDGBOOK is not null and gb.IDGBOOK is not null)
                    -- All ---------------------------------
                    or (fm.FEERECEIVER='PartyA' and fm.FEETYPEPARTYA='All' and (fm.IDROLEACTOR_PARTYA=ar.IDROLEACTOR or fm.IDROLEACTOR_PARTYA is null))
                    or (fm.FEERECEIVER='PartyB' and fm.FEETYPEPARTYB='All' and (fm.IDROLEACTOR_PARTYB=ar.IDROLEACTOR or fm.IDROLEACTOR_PARTYB is null))
                    or (fm.FEERECEIVER='OtherParty1' and fm.FEETYPEOTHERPARTY1='All' and (fm.IDROLEACTOR_OPART1=ar.IDROLEACTOR or fm.IDROLEACTOR_OPART1 is null))
                    or (fm.FEERECEIVER='OtherParty2' and fm.FEETYPEOTHERPARTY2='All' and (fm.IDROLEACTOR_OPART2=ar.IDROLEACTOR or fm.IDROLEACTOR_OPART2 is null))
                    -- ClearingHouse -----------------------
                    or (fm.FEERECEIVER='ClearingHouse' and ar.IDROLEACTOR='CSS')
                  )
              )
              or
              /* ******************************** */
              /* Standard schedule                */ 
              /* ******************************** */
              (
                  fs.IDA is null and not exists (select 1 from dbo.FEESCHEDULE fs_sub where fs_sub.IDENTIFIER=fs.IDENTIFIER and fs_sub.IDA=a.IDA)
                  and 
                  (
                    /* Actor */ 
                    (fm.FEERECEIVER='PartyA' and fm.FEETYPEPARTYA='Actor' and fm.IDPARTYA=a.IDA)
                    or (fm.FEERECEIVER='PartyB' and fm.FEETYPEPARTYB='Actor' and fm.IDPARTYB=a.IDA)
                    or (fm.FEERECEIVER='OtherParty1' and fm.FEETYPEOTHERPARTY1='Actor' and fm.IDOTHERPARTY1=a.IDA)
                    or (fm.FEERECEIVER='OtherParty2' and fm.FEETYPEOTHERPARTY2='Actor' and fm.IDOTHERPARTY2=a.IDA)
                    -- Book --------------------------------
                    or (fm.FEERECEIVER='PartyA' and fm.FEETYPEPARTYA='Book' and fm.IDPARTYA=b.IDB)
                    or (fm.FEERECEIVER='PartyB' and fm.FEETYPEPARTYB='Book' and fm.IDPARTYB=b.IDB)			
                    -- Actors Group ------------------------
                    or (fm.FEERECEIVER='PartyA' and fm.FEETYPEPARTYA='GrpActor' and fm.IDPARTYA=ag.IDGACTOR and gar.IDGACTOR is not null and ga.IDGACTOR is not null)
                    or (fm.FEERECEIVER='PartyB' and fm.FEETYPEPARTYB='GrpActor' and fm.IDPARTYB=ag.IDGACTOR and gar.IDGACTOR is not null and ga.IDGACTOR is not null)
                    or (fm.FEERECEIVER='OtherParty1' and fm.FEETYPEOTHERPARTY1='GrpActor' and fm.IDOTHERPARTY1=ag.IDGACTOR and gar.IDGACTOR is not null and ga.IDGACTOR is not null)
                    or (fm.FEERECEIVER='OtherParty2' and fm.FEETYPEOTHERPARTY2='GrpActor' and fm.IDOTHERPARTY2=ag.IDGACTOR and gar.IDGACTOR is not null and ga.IDGACTOR is not null)
                    -- Books Group -------------------------
                    or (fm.FEERECEIVER='PartyA' and fm.FEETYPEPARTYA='GrpBook' and fm.IDPARTYA=bg.IDGBOOK and gbr.IDGBOOK is not null and gb.IDGBOOK is not null)
                    or (fm.FEERECEIVER='PartyB' and fm.FEETYPEPARTYB='GrpBook' and fm.IDPARTYB=bg.IDGBOOK and gbr.IDGBOOK is not null and gb.IDGBOOK is not null)
                    -- All ---------------------------------
                    or (fm.FEERECEIVER='PartyA' and fm.FEETYPEPARTYA='All' and (fm.IDROLEACTOR_PARTYA=ar.IDROLEACTOR or fm.IDROLEACTOR_PARTYA is null))
                    or (fm.FEERECEIVER='PartyB' and fm.FEETYPEPARTYB='All' and (fm.IDROLEACTOR_PARTYB=ar.IDROLEACTOR or fm.IDROLEACTOR_PARTYB is null))
                    or (fm.FEERECEIVER='OtherParty1' and fm.FEETYPEOTHERPARTY1='All' and (fm.IDROLEACTOR_OPART1=ar.IDROLEACTOR or fm.IDROLEACTOR_OPART1 is null))
                    or (fm.FEERECEIVER='OtherParty2' and fm.FEETYPEOTHERPARTY2='All' and (fm.IDROLEACTOR_OPART2=ar.IDROLEACTOR or fm.IDROLEACTOR_OPART2 is null))
                    -- ClearingHouse -----------------------
                    or (fm.FEERECEIVER='ClearingHouse' and ar.IDROLEACTOR='CSS')
                  )
              )
          )
          and 
          /* ************************************************************ */
          /* 20111216                                                     */
          /* Market and GrpMarket restrict if ClearingHouse               */
          /* TBD Contract and GrpContract restrict if ClearingHouse       */
          /* ************************************************************ */
          (
             (fm.FEERECEIVER!='ClearingHouse') 
			       or
			       (
              (
                (
                  (fs.TYPECONTRACT='Market' and fs.IDCONTRACT in (select IDM from dbo.MARKET where MARKET.IDA=a.IDA))
                   or
                  (fs.TYPECONTRACT='GrpMarket' and fs.IDCONTRACT in (
                    select MARKET.IDM 
                    from dbo.MARKET
                    --left outer join dbo.MARKETG mg on mg.IDM=MARKET.IDM and (mg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (mg.DTDISABLED is null or mg.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.MARKETG mg on mg.IDM=MARKET.IDM and (mg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(mg.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    --left outer join dbo.GMARKETROLE gmr on gmr.IDGMARKET=mg.IDGMARKET and gmr.IDROLEGMARKET='FEE' and (gmr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gmr.DTDISABLED is null or gmr.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.GMARKETROLE gmr on gmr.IDGMARKET=mg.IDGMARKET and gmr.IDROLEGMARKET='FEE' and (gmr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gmr.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    --left outer join dbo.GMARKET gm on gm.IDGMARKET=mg.IDGMARKET and (gm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gm.DTDISABLED is null or gm.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.GMARKET gm on gm.IDGMARKET=mg.IDGMARKET and (gm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gm.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    where MARKET.IDA=a.IDA)
                  )
                )
                and 
                (
                  (fm.TYPECONTRACT='Market' and fm.IDCONTRACT in (select IDM from dbo.MARKET where MARKET.IDA=a.IDA))
                   or
                  (fs.TYPECONTRACT='GrpMarket' and fs.IDCONTRACT in (
                    select MARKET.IDM 
                    from dbo.MARKET
                    --left outer join dbo.MARKETG mg on mg.IDM=MARKET.IDM and (mg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (mg.DTDISABLED is null or mg.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.MARKETG mg on mg.IDM=MARKET.IDM and (mg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(mg.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    --left outer join dbo.GMARKETROLE gmr on gmr.IDGMARKET=mg.IDGMARKET and gmr.IDROLEGMARKET='FEE' and (gmr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gmr.DTDISABLED is null or gmr.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.GMARKETROLE gmr on gmr.IDGMARKET=mg.IDGMARKET and gmr.IDROLEGMARKET='FEE' and (gmr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gmr.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    --left outer join dbo.GMARKET gm on gm.IDGMARKET=mg.IDGMARKET and (gm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gm.DTDISABLED is null or gm.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.GMARKET gm on gm.IDGMARKET=mg.IDGMARKET and (gm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gm.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    where MARKET.IDA=a.IDA)
                  )
                )
              )
              or
              (
                (
                  (fs.TYPECONTRACT='Market' and fs.IDCONTRACT in (select IDM from dbo.MARKET where MARKET.IDA=a.IDA))
                   or
                  (fs.TYPECONTRACT='GrpMarket' and fs.IDCONTRACT in (
                    select MARKET.IDM 
                    from dbo.MARKET
                    --left outer join dbo.MARKETG mg on mg.IDM=MARKET.IDM and (mg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (mg.DTDISABLED is null or mg.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.MARKETG mg on mg.IDM=MARKET.IDM and (mg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(mg.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    --left outer join dbo.GMARKETROLE gmr on gmr.IDGMARKET=mg.IDGMARKET and gmr.IDROLEGMARKET='FEE' and (gmr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gmr.DTDISABLED is null or gmr.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.GMARKETROLE gmr on gmr.IDGMARKET=mg.IDGMARKET and gmr.IDROLEGMARKET='FEE' and (gmr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gmr.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    --left outer join dbo.GMARKET gm on gm.IDGMARKET=mg.IDGMARKET and (gm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gm.DTDISABLED is null or gm.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.GMARKET gm on gm.IDGMARKET=mg.IDGMARKET and (gm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gm.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    where MARKET.IDA=a.IDA)
                  )
                )
                and 
                (fm.TYPECONTRACT is null)
              )
              or                     
              (
                (fs.TYPECONTRACT is null)
                and
                (
                  (fm.TYPECONTRACT='Market' and fm.IDCONTRACT in (select IDM from dbo.MARKET where MARKET.IDA=a.IDA))
                   or
                  (fm.TYPECONTRACT='GrpMarket' and fm.IDCONTRACT in (
                    select MARKET.IDM 
                    from dbo.MARKET
                    --left outer join dbo.MARKETG mg on mg.IDM=MARKET.IDM and (mg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (mg.DTDISABLED is null or mg.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.MARKETG mg on mg.IDM=MARKET.IDM and (mg.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(mg.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    --left outer join dbo.GMARKETROLE gmr on gmr.IDGMARKET=mg.IDGMARKET and gmr.IDROLEGMARKET='FEE' and (gmr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gmr.DTDISABLED is null or gmr.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.GMARKETROLE gmr on gmr.IDGMARKET=mg.IDGMARKET and gmr.IDROLEGMARKET='FEE' and (gmr.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gmr.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    --left outer join dbo.GMARKET gm on gm.IDGMARKET=mg.IDGMARKET and (gm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and (gm.DTDISABLED is null or gm.DTDISABLED>%%DA:DATE1.GetDataSQLValue()%%))
                    left outer join dbo.GMARKET gm on gm.IDGMARKET=mg.IDGMARKET and (gm.DTENABLED<=%%DA:DATE1.GetDataSQLValue()%% and isnull(gm.DTDISABLED,%%DA:DATE1.GetDataSQLValue()%%+1)>%%DA:DATE1.GetDataSQLValue()%%)
                    where MARKET.IDA=a.IDA)
                  )
                )
              )
              or 
              (
                (fs.TYPECONTRACT is null)
                and
                (fm.TYPECONTRACT is null)
              )
			      )
	      )
        ]]>
      </Command>
    </SQLSelect>

    <SQLRowStyle type="style">case tblmain.FEEPAYERORRECEIVER when 'Payer' then 'background-color:#FCD4D4' else 'background-color:#DBEAC8' end</SQLRowStyle>
    
    <SQLWhere>
      <ConditionSystem>SESSIONRESTRICT</ConditionSystem>
      <SQLJoin>%%SR:ACTOR_JOIN%%(tblmain.IDA)</SQLJoin>
    </SQLWhere>
    
    <Column>
      <ColumnName>IDA</ColumnName>
      <Ressource>IDA</Ressource>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsForeignKeyField>true</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>true</IsOrderBy>
      <Relation>
        <TableName>ACTOR</TableName>
        <ColumnRelation>
          <ColumnName>IDA</ColumnName>
          <DataType>int</DataType>
        </ColumnRelation>
        <ColumnSelect>
          <ColumnName>IDENTIFIER</ColumnName>
          <Ressource>Actor</Ressource>
          <DataType>string</DataType>
        </ColumnSelect>
        <AutoComplete enabled="true"/>
      </Relation>
    </Column>
    <Column>
      <ColumnName>IDFEEMATRIX</ColumnName>
      <Ressource>FEEMATRIX_IDENTIFIER</Ressource>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>true</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
        <TableName>FEEMATRIX</TableName>
        <ColumnRelation>
          <ColumnName>IDFEEMATRIX</ColumnName>
          <DataType>int</DataType>
        </ColumnRelation>
        <ColumnSelect>
          <ColumnName>IDENTIFIER</ColumnName>
          <Ressource>FEEMATRIX_IDENTIFIER</Ressource>
          <DataType>string</DataType>
        </ColumnSelect>
      </Relation>
    </Column>
    <!--<Column>
      <ColumnName>FEEMATRIX_IDENTIFIER</ColumnName>
      <Ressource>FEEMATRIX_IDENTIFIER</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>-->
    <Column>
      <ColumnName>FEEMATRIX_DISPLAYNAME</ColumnName>
      <Ressource>FEEMATRIX_DISPLAYNAME</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>FEEPAYERORRECEIVER</ColumnName>
      <Ressource>FEEPAYERORRECEIVER</Ressource>
      <DataType>string</DataType>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <IsResource>true</IsResource>
      <CellStyle model="side"/>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>FEETYPEPARTYA</ColumnName>
      <Ressource>FEEMATRIX_FEETYPEPARTYA</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <IsResource>true</IsResource>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>IDPARTYA</ColumnName>
      <Ressource>FEEMATRIX_IDPARTYA</Ressource>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
        <TableName>VW_FEEMATRIXPARTYA</TableName>
        <ColumnRelation>
          <ColumnName>ID_</ColumnName>
          <DataType>string</DataType>
        </ColumnRelation>
        <ColumnSelect>
          <ColumnName>IDENTIFIER</ColumnName>
          <Ressource>FEEMATRIX_IDPARTYA</Ressource>
          <DataType>string</DataType>
        </ColumnSelect>
        <ColumnLabel>
          <ColumnName>DISPLAYNAME</ColumnName>
          <Ressource>IDPARTYA</Ressource>
          <DataType>string</DataType>
        </ColumnLabel>
        <Condition apply="ALL">
          <SQLWhere>FEETYPEPARTYA = tblmain.FEETYPEPARTYA</SQLWhere>
        </Condition>
        <AutoComplete enabled="true"/>
      </Relation>
    </Column>
    <Column>
      <ColumnName>IDROLEACTOR_PARTYA</ColumnName>
      <Ressource>FEEMATRIX_IDROLEACTOR_PARTYA</Ressource>
      <DataType>string</DataType>
      <Length>16</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>IDFEE</ColumnName>
      <Ressource>FEESCHEDULE_IDFEE</Ressource>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
        <TableName>FEE</TableName>
        <ColumnRelation>
          <ColumnName>IDFEE</ColumnName>
          <DataType>int</DataType>
        </ColumnRelation>
        <ColumnSelect>
          <ColumnName>IDENTIFIER</ColumnName>
          <Ressource>FEESCHEDULE_IDFEE</Ressource>
          <DataType>string</DataType>
        </ColumnSelect>
      </Relation>
    </Column>
    <Column>
      <ColumnName>IDFEESCHEDULE</ColumnName>
      <Ressource>FEESCHEDULE_IDFEESCHEDULE</Ressource>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
        <TableName>FEESCHEDULE</TableName>
        <ColumnRelation>
          <ColumnName>IDFEESCHEDULE</ColumnName>
          <DataType>int</DataType>
        </ColumnRelation>
        <ColumnSelect>
          <ColumnName>IDENTIFIER</ColumnName>
          <Ressource>FEESCHEDULE_IDFEESCHEDULE</Ressource>
          <DataType>string</DataType>
        </ColumnSelect>
      </Relation>
    </Column>
    <Column>
      <ColumnName>DISPLAYNAME</ColumnName>
      <Ressource>FEESCHEDULE_DISPLAYNAME</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>IDC</ColumnName>
      <Ressource>FEESCHEDULE_IDC</Ressource>
      <DataType>string</DataType>
      <Length>3</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
    <!--<Column>
      <ColumnName>IDC_FEE1</ColumnName>
      <Ressource>FEESCHEDULE_IDC_FEE1</Ressource>
      <DataType>string</DataType>
      <Length>3</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation></Relation>
    </Column>-->
    <Column>
      <ColumnName>SCHEDULECLASS</ColumnName>
      <Ressource>FEESCHEDULE_CLASS</Ressource>
      <DataType>string</DataType>
      <Length>11</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <IsResource>true</IsResource>
      <CellStyle model="side"/>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>ACTION</ColumnName>
      <Ressource>FEEMATRIX_ACTION</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <IsResource>true</IsResource>
      <Relation>
        <TableName>VW_ALL_VW_PERMIS_MENU</TableName>
        <ColumnRelation>
          <ColumnName>IDPERMISSION</ColumnName>
          <DataType>string</DataType>
        </ColumnRelation>
        <ColumnSelect>
          <ColumnName>MNU_DESC</ColumnName>
          <Ressource>FEEMATRIX_ACTION</Ressource>
          <DataType>string</DataType>
        </ColumnSelect>
      </Relation>
    </Column>
    <Column>
      <ColumnName>FEESCOPE</ColumnName>
      <Ressource>FEESCHEDULE_FEESCOPE</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>IDSTBUSINESS</ColumnName>
      <Ressource>FEEMATRIX_IDSTBUSINESS</Ressource>
      <DataType>string</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <IsResource>true</IsResource>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>GPRODUCT</ColumnName>
      <Ressource>FEEMATRIX_GPRODUCT</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>FEEMATRIX_TYPEINSTR</ColumnName>
      <Ressource>TYPEINSTR_FEEMATRIX</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <IsResource>true</IsResource>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>FEEMATRIX_IDINSTR</ColumnName>
      <Ressource></Ressource>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
        <TableName>VW_FEEMATRIXINSTR</TableName>
        <ColumnRelation>
          <ColumnName>ID_</ColumnName>
          <DataType>string</DataType>
        </ColumnRelation>
        <ColumnSelect>
          <ColumnName>DISPLAYNAME</ColumnName>
          <Ressource>FEEMATRIX_IDINSTR</Ressource>
          <DataType>string</DataType>
        </ColumnSelect>
      </Relation>
    </Column>
    <Column>
      <ColumnName>FEEMATRIX_TYPECONTRACT</ColumnName>
      <Ressource>TYPECONTRACT_FEEMATRIX</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <IsResource>true</IsResource>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>FEEMATRIX_IDCONTRACT</ColumnName>
      <Ressource></Ressource>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
        <TableName>VW_FEEMATRIXCT</TableName>
        <ColumnRelation>
          <ColumnName>ID_</ColumnName>
          <DataType>string</DataType>
        </ColumnRelation>
        <ColumnSelect>
          <ColumnName>IDENTIFIER</ColumnName>
          <Ressource>FEEMATRIX_IDCONTRACT</Ressource>
          <DataType>string</DataType>
        </ColumnSelect>
        <ColumnLabel>
          <ColumnName>DISPLAYNAME</ColumnName>
          <Ressource>DISPLAYNAME</Ressource>
          <DataType>string</DataType>
        </ColumnLabel>
        <Condition apply="ALL">
          <SQLWhere>TYPECONTRACT = tblmain.FEEMATRIX_TYPECONTRACT</SQLWhere>
        </Condition>
      </Relation>
    </Column>
    <Column>
      <ColumnName>FEEMATRIX_TYPECONTRACTEXCEPT</ColumnName>
      <Ressource>TYPECONTRACTEXCEPT_FEEMATRIX</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <IsResource>true</IsResource>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>FEEMATRIX_IDCONTRACTEXCEPT</ColumnName>
      <Ressource></Ressource>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInDataGrid></IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
        <TableName>VW_FEEMATRIXEXCPCT</TableName>
        <ColumnRelation>
          <ColumnName>ID_</ColumnName>
          <DataType>string</DataType>
        </ColumnRelation>
        <ColumnSelect>
          <ColumnName>IDENTIFIER</ColumnName>
          <Ressource>FEEMATRIX_IDCONTRACTEXCEPT</Ressource>
          <DataType>string</DataType>
        </ColumnSelect>
        <ColumnLabel>
          <ColumnName>DISPLAYNAME</ColumnName>
          <Ressource>DISPLAYNAME</Ressource>
          <DataType>string</DataType>
        </ColumnLabel>
        <Condition apply="ALL">
          <SQLWhere>TYPECONTRACTEXCEPT = tblmain.FEEMATRIX_TYPECONTRACTEXCEPT</SQLWhere>
        </Condition>
      </Relation>
    </Column>
    <Column>
      <ColumnName>FEEMATRIX_TYPEINSTR_UNL</ColumnName>
      <Ressource>TYPEINSTR_UNL_FEEMATRIX</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <IsResource>true</IsResource>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>FEEMATRIX_IDINSTR_UNL</ColumnName>
      <Ressource></Ressource>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
        <TableName>VW_FEEMATRIXINSTR</TableName>
        <ColumnRelation>
          <ColumnName>ID_</ColumnName>
          <DataType>string</DataType>
        </ColumnRelation>
        <ColumnSelect>
          <ColumnName>IDENTIFIER</ColumnName>
          <Ressource>FEEMATRIX_IDINSTR_UNL</Ressource>
          <DataType>string</DataType>
        </ColumnSelect>
        <ColumnLabel>
          <ColumnName>DISPLAYNAME</ColumnName>
          <Ressource>DISPLAYNAME</Ressource>
          <DataType>string</DataType>
        </ColumnLabel>
        <Condition apply="ALL">
          <SQLWhere>TYPEINSTR_UNL = tblmain.FEEMATRIX_TYPEINSTR_UNL</SQLWhere>
        </Condition>
      </Relation>
    </Column>
    <Column>
      <ColumnName>ASSETCATEGORY</ColumnName>
      <Ressource>FEEMATRIX_ASSETCATEGORY</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>FEEMATRIX_ISEXCLUDEIDC</ColumnName>
      <Ressource>ISEXCLUDEIDC_FEEMATRIX</Ressource>
      <DataType>string</DataType>
      <Length>1</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <IsResource>true</IsResource>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>FEEMATRIX_IDC</ColumnName>
      <Ressource></Ressource>
      <DataType>string</DataType>
      <Length>3</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>TAXAPPLICATION</ColumnName>
      <Ressource>FEEMATRIX_TAXAPPLICATION</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <IsResource>true</IsResource>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>ISINVOICING</ColumnName>
      <Ressource>FEEMATRIX_ISINVOICING</Ressource>
      <DataType>bool</DataType>
      <Length>1</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>DTENABLED</ColumnName>
      <Ressource>FEEMATRIX_DTENABLED</Ressource>
      <DataType>date</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>DTDISABLED</ColumnName>
      <Ressource>FEEMATRIX_DTDISABLED</Ressource>
      <DataType>date</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
  </Referential>
</Referentials>
<!-- Sample -->
<!-- <html_BLOCK title="Sample" blockbyrow="2" width="75%" columnbyrow="1"></html_BLOCK> -->
<!-- <html_HR title="Sample"></html_HR> -->
<!-- <Information> -->
<!-- <Type>information|warning</Type> -->
<!-- <ToolTipMessage|PopupMessage|LabelMessage> -->
<!-- Message... -->
<!-- </ToolTipMessage|PopupMessage|LabelMessage> -->
<!-- </Information> -->
