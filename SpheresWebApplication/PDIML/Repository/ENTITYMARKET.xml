<?xml version="1.0" encoding="utf-8" ?>
<!-- FI 20120926 [XXXXX] usage of data attribute for HyperLink column -->
<!-- PM 20150520 [20575] Replace em.DTMARKETPREV, em.DTMARKET and em.DTMARKETNEXT with em.DTENTITYPREV, em.DTENTITY and em.DTENTITYNEXT -->
<!-- FI 20220113 [XXXXX] Refactoring -->
<!-- RD 20220310 [25961] Replace 'em.IDA' with 'em.IDA as IDA_ENTITY' and 'a_csscust.IDA as CSSCUSTODIAN_IDA' with 'a_csscust.IDA as IDA_CSSCUSTODIAN' -->
<!-- EG 20240605 [XXXXX] Gestion des marchés désactivés-->
<Referentials>
  <Referential>
    <freezeColumn>8</freezeColumn>
    <TableName>ENTITYMARKET</TableName>
    <Create>false</Create>
    <Modify>true</Modify>
    <Remove>false</Remove>
    <Duplicate>false</Duplicate>
    <Notepad>false</Notepad>

    <SQLSelect>
      <Command rdbms = "all">
        select em.IDEM,
        em.IDA as IDA_ENTITY,
        a_entity.IDENTIFIER as ENTITY_IDENTIFIER, a_entity.DISPLAYNAME as ENTITY_DISPLAYNAME,entity.IDBCACCOUNT as ENTITY_IDBC,
        em.IDA_CUSTODIAN,
        a_csscust.IDA as IDA_CSSCUSTODIAN,
        a_csscust.IDENTIFIER as CSSCUSTODIAN_IDENTIFIER, a_csscust.DISPLAYNAME as CSSCUSTODIAN_DISPLAYNAME,a_csscust.IDBC as CSSCUSTODIAN_IDBC,
        em.IDM,
        mk.SHORT_ACRONYM as MARKET, mk.DISPLAYNAME as MARKET_DISPLAYNAME, mk.IDBC as MARKET_IDBC,
        em.DTENTITYPREV, em.DTENTITY, em.DTENTITYNEXT,
        em.DTENTITYPREV as DTENTITYPREV_GRID, em.DTENTITY as DTENTITY_GRID, em.DTENTITYNEXT as DTENTITYNEXT_GRID,
        em.DTMARKETPREV, em.DTMARKET, em.DTMARKETNEXT,
        em.DTMARKETPREV as DTMARKETPREV_GRID, em.DTMARKET as DTMARKET_GRID, em.DTMARKETNEXT as DTMARKETNEXT_GRID,
        em.ISAUTOABN, em.ISSHORTCALLCOVER, em.ISIMCROSSMARGINING, em.POSSTOCKCOVER,
        case when em.IDA_CUSTODIAN is null then 0 else 1 end as ISCUSTODIAN,
        case when em.IDA_CUSTODIAN is null then 1 else 0 end as ISCSS,
        case when em.DTENTITY = em.DTMARKET  then 0 else 1 end as ISMARKETCLOSED,
        case when em.IDA_CUSTODIAN is null then 0 else case when em.IDM &gt; 0 then 1 else 2 end end as SORTED,
        mk.DTENABLED, mk.DTDISABLED
        from dbo.ENTITYMARKET em
        inner join dbo.VW_MARKET_IDENTIFIER mk on (mk.IDM = em.IDM)
        inner join dbo.ACTOR a_entity on (a_entity.IDA = em.IDA)
        inner join dbo.ACTOR a_csscust on (a_csscust.IDA = isnull(em.IDA_CUSTODIAN, mk.IDA))
        left outer join dbo.ENTITY entity on (entity.IDA = em.IDA)
      </Command>
    </SQLSelect>


    <SQLRowStyle type="class">
      case when ISMARKETCLOSED = 1 then 'em_marketclosed' 
      else
        case when ISCUSTODIAN =1 then
            case when IDM = -1 then 'em_otc' else 'em_custodian' end 
        else 
          'em_css' 
        end
      end 
    </SQLRowStyle>

    <SQLRowState>
      case ISCUSTODIAN when 1 then case when IDM = -1 then 'lstaw=name:otcmarket;title:OTC Market' else 'lstaw=name:custodian;title:Custodian' end
      else 'lstaw=name:css;title:ClearingHouse' end
    </SQLRowState>
    
    <Column>
      <ColumnName>IDEM</ColumnName>
      <Ressource>ID</Ressource>
      <DataType>int</DataType>
      <Scale>0</Scale>
      <Align>left</Align>
      <Colspan>3</Colspan>
      <IsMandatory>true</IsMandatory>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsDataKeyField>true</IsDataKeyField>
      <IsUpdatable>false</IsUpdatable>
    </Column>
    <Column>
      <ColumnName>ISCUSTODIAN</ColumnName>
      <Ressource>SEE_CUSTODIAN</Ressource>
      <DataType>bool</DataType>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>false</IsHideInCriteria>
      <IsDataKeyField>false</IsDataKeyField>
      <IsVirtualColumn>true</IsVirtualColumn>
    </Column>
    <Column>
      <ColumnName>ISCSS</ColumnName>
      <Ressource>SEE_CSS</Ressource>
      <DataType>bool</DataType>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>false</IsHideInCriteria>
      <IsVirtualColumn>true</IsVirtualColumn>
    </Column>
    <Column>
      <ColumnName>SORTED</ColumnName>
      <Ressource>SORTED</Ressource>
      <DataType>int</DataType>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsOrderBy>true</IsOrderBy>
      <IsVirtualColumn>true</IsVirtualColumn>
    </Column>

    <!-- ENTITY -->
    <Column>
      <ColumnName>IDA_ENTITY</ColumnName>
      <Ressource>IDA_ENTITY</Ressource>
      <DataType>int</DataType>
      <IsMandatory>true</IsMandatory>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsForeignKeyField>true</IsForeignKeyField>
      <IsUpdatable>false</IsUpdatable>
    </Column>
    <Column>
      <ColumnName>ENTITY_IDENTIFIER</ColumnName>
      <Ressource>IDA_ENTITY_3</Ressource>
      <DataType>string</DataType>
      <IsMandatory>true</IsMandatory>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInCriteria>false</IsHideInCriteria>
      <IsUpdatable>false</IsUpdatable>
      <IsVirtualColumn>true</IsVirtualColumn>
      <IsHyperLink linktype="column" type="IDA" data="IDA">true</IsHyperLink>
      <html_BLOCK title="IDA_ENTITY_" columnbyrow="3" ></html_BLOCK>
    </Column>
    <Column>
      <ColumnName>ENTITY_DISPLAYNAME</ColumnName>
      <InputWidth>50%</InputWidth>
      <DataType>string</DataType>
      <IsMandatory>false</IsMandatory>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInCriteria>false</IsHideInCriteria>
      <IsUpdatable>false</IsUpdatable>
      <IsVirtualColumn>true</IsVirtualColumn>
    </Column>
    <Column>
      <ColumnName>ENTITY_IDBC</ColumnName>
      <Ressource>ENTITY_IDBC</Ressource>
      <Colspan>2</Colspan>
      <DataType>string</DataType>
      <Length>32</Length>
      <IsMandatory>false</IsMandatory>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInCriteria>false</IsHideInCriteria>
      <IsVirtualColumn>true</IsVirtualColumn>
      <IsHyperLink linktype="column" type="IDBC" data="ENTITY_IDBC">true</IsHyperLink>
      <Relation>
        <DDLType>businesscenter</DDLType>
      </Relation>
    </Column>

   <!-- DTENTITY GRID -->
    <Column>
      <ColumnName>DTENTITYPREV_GRID</ColumnName>
      <Ressource>DTENTITYALL_GRID</Ressource>
      <DataType>date</DataType>
      <IsMandatory>true</IsMandatory>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInCriteria>false</IsHideInCriteria>
      <IsUpdatable>false</IsUpdatable>
      <IsVirtualColumn>true</IsVirtualColumn>
    </Column>
    <Column>
      <ColumnName>DTENTITY_GRID</ColumnName>
      <Ressource></Ressource>
      <DataType>date</DataType>
      <IsMandatory>true</IsMandatory>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInCriteria>false</IsHideInCriteria>
      <IsUpdatable>false</IsUpdatable>
      <IsVirtualColumn>true</IsVirtualColumn>
    </Column>
    <Column>
      <ColumnName>DTENTITYNEXT_GRID</ColumnName>
      <Ressource></Ressource>
      <DataType>date</DataType>
      <IsMandatory>true</IsMandatory>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInCriteria>false</IsHideInCriteria>
      <IsUpdatable>false</IsUpdatable>
      <IsVirtualColumn>true</IsVirtualColumn>
    </Column>

    <!-- DTENTITY -->
    <Column>
      <ColumnName>DTENTITYPREV</ColumnName>
      <Ressource>DTENTITYPREV</Ressource>
      <DataType>date</DataType>
      <IsMandatory>true</IsMandatory>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsUpdatable>false</IsUpdatable>
      <html_HR  size="1" />
    </Column>
    <Column>
      <ColumnName>DTENTITY</ColumnName>
      <Ressource>DTENTITY</Ressource>
      <DataType>date</DataType>
      <IsMandatory>true</IsMandatory>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsUpdatable>false</IsUpdatable>
    </Column>
    <Column>
      <ColumnName>DTENTITYNEXT</ColumnName>
      <Ressource>DTENTITYNEXT</Ressource>
      <DataType>date</DataType>
      <IsMandatory>true</IsMandatory>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsUpdatable>false</IsUpdatable>
    </Column>
    
    <!-- CUSTODIAN -->
    <Column>
      <ColumnName>IDA_CUSTODIAN</ColumnName>
      <DataType>int</DataType>
      <IsMandatory>false</IsMandatory>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsUpdatable>false</IsUpdatable>
    </Column>
    <Column>
      <ColumnName>IDA_CSSCUSTODIAN</ColumnName>
      <Ressource>IDA_CSSCUSTODIAN</Ressource>
      <DataType>int</DataType>
      <IsMandatory>true</IsMandatory>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsUpdatable>false</IsUpdatable>
      <IsVirtualColumn>true</IsVirtualColumn>
    </Column>
    <Column>
      <ColumnName>CSSCUSTODIAN_IDENTIFIER</ColumnName>
      <Ressource>CssCustodian3</Ressource>
      <DataType>string</DataType>
      <IsMandatory>true</IsMandatory>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInCriteria>false</IsHideInCriteria>
      <IsUpdatable>false</IsUpdatable>
      <IsVirtualColumn>true</IsVirtualColumn>
      <IsHyperLink linktype="column" type="IDA" data="IDA_CSSCUSTODIAN">true</IsHyperLink>
      <html_BLOCK title="CssCustodian_" columnbyrow="3" ></html_BLOCK>
    </Column>
    <Column>
      <ColumnName>CSSCUSTODIAN_DISPLAYNAME</ColumnName>
      <InputWidth>50%</InputWidth>
      <DataType>string</DataType>
      <IsMandatory>false</IsMandatory>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsUpdatable>false</IsUpdatable>
      <IsVirtualColumn>true</IsVirtualColumn>
    </Column>
    <Column>
      <ColumnName>CSSCUSTODIAN_IDBC</ColumnName>
      <Ressource>CSSCUSTODIAN_IDBC</Ressource>
      <Colspan>2</Colspan>
      <DataType>string</DataType>
      <Length>32</Length>
      <IsMandatory>false</IsMandatory>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsUpdatable>false</IsUpdatable>
      <IsHyperLink linktype="column" type="IDBC" data="CSSCUSTODIAN_IDBC">true</IsHyperLink>
      <IsVirtualColumn>true</IsVirtualColumn>
      <Relation>
        <DDLType>businesscenter</DDLType>
      </Relation>
      <!--<html_HR title="Holiday" size="1" />-->
    </Column>

    <!-- MARKET -->
    <Column>
      <ColumnName>IDM</ColumnName>
      <Ressource>IDM</Ressource>
      <DataType>int</DataType>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsUpdatable>false</IsUpdatable>
    </Column>
    <Column>
      <ColumnName>MARKET</ColumnName>
      <Ressource>IDM_SHORT_ACRONYM2</Ressource>
      <DataType>string</DataType>
      <IsMandatory>true</IsMandatory>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInCriteria>false</IsHideInCriteria>
      <IsUpdatable>false</IsUpdatable>
      <IsVirtualColumn>true</IsVirtualColumn>
      <IsHyperLink linktype="column" type="IDM" data="IDM">true</IsHyperLink>
    </Column>
    <Column>
      <ColumnName>MARKET_DISPLAYNAME</ColumnName>
      <InputWidth>50%</InputWidth>
      <DataType>string</DataType>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInCriteria>false</IsHideInCriteria>
      <IsUpdatable>false</IsUpdatable>
      <IsVirtualColumn>true</IsVirtualColumn>
    </Column>
    <Column>
      <ColumnName>MARKET_IDBC</ColumnName>
      <Ressource>MARKET_IDBC</Ressource>
      <ColSpan>2</ColSpan>
      <DataType>string</DataType>
      <Length>32</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsUpdatable>false</IsUpdatable>
      <IsVirtualColumn>true</IsVirtualColumn>
      <IsHyperLink linktype="column" type="IDBC" data="MARKET_IDBC">true</IsHyperLink>
      <Relation>
        <DDLType>businesscenter</DDLType>
      </Relation>
      <!--<html_HR title="Holiday" size="1" />-->
    </Column>

    <!-- DTMARKET GRID-->
    <Column>
      <ColumnName>DTMARKETPREV_GRID</ColumnName>
      <Ressource>DTMARKETALL_GRID</Ressource>
      <DataType>date</DataType>
      <IsMandatory>true</IsMandatory>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInCriteria>false</IsHideInCriteria>
      <IsVirtualColumn>true</IsVirtualColumn>
    </Column>
    <Column>
      <ColumnName>DTMARKET_GRID</ColumnName>
      <Ressource></Ressource>
      <DataType>date</DataType>
      <IsMandatory>true</IsMandatory>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsVirtualColumn>true</IsVirtualColumn>
    </Column>
    <Column>
      <ColumnName>DTMARKETNEXT_GRID</ColumnName>
      <Ressource></Ressource>
      <DataType>date</DataType>
      <IsMandatory>true</IsMandatory>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsVirtualColumn>true</IsVirtualColumn>
    </Column>  
      
    <!-- DTMARKET -->  
    <Column>
      <ColumnName>DTMARKETPREV</ColumnName>
      <Ressource>DTMARKETPREV</Ressource>
      <DataType>date</DataType>
      <IsMandatory>true</IsMandatory>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsUpdatable>false</IsUpdatable>
      <html_HR size="1" />
    </Column>
    <Column>
      <ColumnName>DTMARKET</ColumnName>
      <Ressource>DTMARKET</Ressource>
      <DataType>date</DataType>
      <IsMandatory>true</IsMandatory>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsUpdatable>false</IsUpdatable>
    </Column>
    <Column>
      <ColumnName>DTMARKETNEXT</ColumnName>
      <Ressource>DTMARKETNEXT</Ressource>
      <DataType>date</DataType>
      <IsMandatory>true</IsMandatory>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsUpdatable>false</IsUpdatable>
    </Column>

    <Column>
      <ColumnName>DTENABLED</ColumnName>
      <Ressource>DTENABLED</Ressource>
      <DataType>date</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression>
      </RegularExpression>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>DTDISABLED</ColumnName>
      <Ressource>DTDISABLED</Ressource>
      <DataType>date</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression>
      </RegularExpression>
      <Default>
      </Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <Relation>
      </Relation>
    </Column>

    <!-- RULES (ISAUTOABN,ISSHORTCALLCOVER, etc -->  
    <Column>
      <ColumnName>ISAUTOABN</ColumnName>
      <Ressource>ISAUTOABN</Ressource>
      <DataType>bool</DataType>
      <Length>1</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression>
      </RegularExpression>
      <Default>
        <Value>false</Value>
      </Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsUpdatable>true</IsUpdatable>
      <Relation></Relation>
      <html_BLOCK title="Rules" columnbyrow="1" ></html_BLOCK>
    </Column>
    <Column>
      <ColumnName>ISSHORTCALLCOVER</ColumnName>
      <Ressource>ISSHORTCALLCOVER</Ressource>
      <DataType>bool</DataType>
      <Length>1</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression>
      </RegularExpression>
      <Default>
        <Value>false</Value>
      </Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsUpdatable>true</IsUpdatable>
      <Relation></Relation>
    </Column>
    <Column>
      <ColumnName>ISIMCROSSMARGINING</ColumnName>
      <Ressource>ISIMCROSSMARGINING</Ressource>
      <DataType>bool</DataType>
      <Length>1</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression>
      </RegularExpression>
      <Default>
        <Value>false</Value>
      </Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsUpdatable>true</IsUpdatable>
      <Relation></Relation>
    </Column>
    <Column>
      <ColumnName>POSSTOCKCOVER</ColumnName>
      <Ressource>POSSTOCKCOVER</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsUpdatable>true</IsUpdatable>
      <IsResource>false</IsResource>
      <Relation>
        <DDLType>enum.PosStockCoverEnum</DDLType>
      </Relation>
      <html_HR size="1"></html_HR>
    </Column>
  </Referential>
</Referentials>
