<?xml version="1.0" encoding="utf-8" ?>
<Referentials>
  <!-- 20120612 MF Ticket 17886 - Referential for strategy identification rules -->
  <Referential>
    <!-- FI 20210219 [XXXXX] Add -->
    <JQuery function="Init"/>
    <TableName>STGIDENTRULES</TableName>
    <Ressource>STGIDENTRULES</Ressource>
    <ColumnByRow>3</ColumnByRow>
    <Create>true</Create>
    <Modify>true</Modify>
    <Remove>true</Remove>
    <Image></Image>

    <SQLWhere>
      <!-- join for limited resultset to current elementtype -->
      <SQLJoin>
        left outer join dbo.VW_STGIDENTRULESINSTR vw_ti1 on (vw_ti1.TYPEINSTR=tblmain.TYPEINSTR and vw_ti1.ID=vw_ti2.ID)
        left outer join dbo.VW_STGIDENTRULESCONTRACT vw_tc1 on (vw_tc1.TYPECONTRACT=tblmain.TYPECONTRACT and vw_tc1.ID=vw_tc2.ID)
      </SQLJoin>
      <SQLWhere>
        (vw_ti1.TYPEINSTR is not null or vw_ti2.ID is null)
        and
        (vw_tc1.TYPECONTRACT is not null or vw_tc2.ID is null)
      </SQLWhere>
    </SQLWhere>

    <SQLWhere>
      <!--
      USER non admin peut accéder aux acteurs :                             
      - non affectés à un profil (ou model) et créés ou modifiés par lui-même                     
      - accessibles par application des profils rattachés à lui ou à sa hiérarchie (ISENABLED=true) 
      - dits publics ACTEUR.ISENABLED=true                            
      -->
      <ConditionSystem>SESSIONRESTRICT</ConditionSystem>
      <SQLJoin>left outer join dbo.SESSIONRESTRICT sr on sr.ID=tblmain.IDA and sr.CLASS='ACTOR' and sr.SESSIONID='%%SESSIONID%%'</SQLJoin>
      <SQLWhere>
        <![CDATA[
        (
          (sr.ID is not null) 
          or
          (
            (not exists(select 1 from dbo.ACTORMODEL where IDA=tblmain.IDA)) 
            and
            ((tblmain.IDAINS=%%ID_USER%% and tblmain.IDAUPD is null) or tblmain.IDAUPD=%%ID_USER%%)
          )
        )
        ]]>
      </SQLWhere>
    </SQLWhere>
    
    <!-- BLOCK CHARACTERISTICS -->

    <Column>
      <ColumnName>IDSTGIDENTRULES</ColumnName>
      <Ressource>IDSTGIDENTRULES</Ressource>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>true</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>true</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
      <html_BLOCK title="Characteristics" columnbyrow="3" ></html_BLOCK>
    </Column>

    <!-- BLOCK CARACTERISTICS -->

    <Column>
      <ColumnName>IDENTIFIER</ColumnName>
      <Ressource>IDENTIFIER</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>true</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>true</IsOrderBy>
      <Relation>
      </Relation>
      <JavaScript>
        <Script attribut="onblur" name="EFS_Copy" control="DISPLAYNAME" condition="new"></Script>
      </JavaScript>
    </Column>
    <Column>
      <ColumnName>DISPLAYNAME</ColumnName>
      <Ressource>DISPLAYNAME</Ressource>
      <DataType>string</DataType>
      <Colspan>2</Colspan>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>DESCRIPTION</ColumnName>
      <Ressource>DESCRIPTION</Ressource>
      <DataType>string</DataType>
      <Colspan>0</Colspan>
      <Length>128</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>

    <!-- BLOCK CONTEXT -->

    <Column>
      <ColumnName>IDA</ColumnName>
      <Ressource>IDA</Ressource>
      <Colspan>0</Colspan>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
        <TableName>ACTOR</TableName>
        <AliasTableName>a1</AliasTableName>
        <ColumnRelation>
          <ColumnName>IDA</ColumnName>
          <DataType>int</DataType>
        </ColumnRelation>
        <ColumnSelect>
          <ColumnName>IDENTIFIER</ColumnName>
          <Ressource>IDA_ENTITY_</Ressource>
          <DataType>string</DataType>
        </ColumnSelect>
        <ColumnLabel>
          <ColumnName>DISPLAYNAME</ColumnName>
          <Ressource>DISPLAYNAME</Ressource>
          <DataType>string</DataType>
        </ColumnLabel>
        <Condition>
          <TableName>ACTORROLE</TableName>
          <ColumnRelation>
            <ColumnName>IDA</ColumnName>
            <DataType>int</DataType>
          </ColumnRelation>
          <SQLWhere>ACTORROLE.IDROLEACTOR = 'ENTITY'</SQLWhere>
        </Condition>
        <!--and ACTORROLE.IDA in (select IDA from dbo.ENTITY)-->
        <AutoComplete enabled="true"/>
      </Relation>
      <Information>
        <Type>information</Type>
        <LabelMessage>Msg_IDA_ENTITYForSTGIDENTRULES</LabelMessage>
      </Information>
      <html_BLOCK title="EnvironmentContext_Title">
        <Information>
          <Type>information</Type>
          <LabelMessage>Msg_IDA_ENTITY2ForSTGIDENTRULES</LabelMessage>
        </Information>
      </html_BLOCK>
      <html_HR title="Entity2_Title"></html_HR>
    </Column>
    <Column>
      <ColumnName>TYPEINSTR</ColumnName>
      <Ressource>TYPEINSTR</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <IsAutoPostBack>false</IsAutoPostBack>
      <Relation>
        <DDLType>enum.[code:TypeInstrEnum;condition:(VALUE not in('GrpProduct'))]</DDLType>
      </Relation>
      <html_HR title="InstrumentCriteria"></html_HR>
    </Column>
    <Column>
      <ColumnName>IDINSTR</ColumnName>
      <Ressource>IDINSTR</Ressource>
      <Colspan>2</Colspan>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
        <TableName>VW_STGIDENTRULESINSTR</TableName>
        <AliasTableName>vw_ti2</AliasTableName>
        <ColumnRelation>
          <ColumnName>ID_</ColumnName>
          <DataType>string</DataType>
        </ColumnRelation>
        <ColumnSelect>
          <ColumnName>DISPLAYNAME</ColumnName>
          <Ressource>IDINSTR</Ressource>
          <DataType>string</DataType>
        </ColumnSelect>
        <Condition>
          <!-- 1. GPRODUCT = 'FUT' exclude all the products/instruments not related to the "Future" group (ETD products) -->
          <!-- 2. TYPEINSTR='GrpInstr' - force loading all the instruments group related to the role STGIDENT as well
               as defined in the main view VW_STGIDENTRULESINSTR for the IDINSTR column -->
          <SQLWhere>(TYPEINSTR='%%COLUMN_VALUE%%TYPEINSTR%%') and (GPRODUCT = 'FUT' or TYPEINSTR='GrpInstr')</SQLWhere>
        </Condition>
      </Relation>
      <Information>
        <Type>information</Type>
        <!--<ToolTipMessage>Msg_IDINSTRSTG</ToolTipMessage>-->
        <LabelMessage>Msg_PRODUCT-INSTRUMENT-STGIDENTRULES</LabelMessage>
        <ToolTipMessage>Msg_PRODUCT-INSTRUMENT2-STGIDENTRULES</ToolTipMessage>
      </Information>
    </Column>
    <Column>
      <ColumnName>TYPECONTRACT</ColumnName>
      <Ressource>TYPECONTRACT</Ressource>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <IsAutoPostBack>false</IsAutoPostBack>
      <Relation>
        <DDLType>enum.[code:TypeContractEnum;condition:(VALUE not in('CommodityContract'))]</DDLType>
      </Relation>
      <html_HR title="MarketContract_Title"></html_HR>
    </Column>
    <Column>
      <ColumnName>IDCONTRACT</ColumnName>
      <Ressource>IDCONTRACT</Ressource>
      <Colspan>2</Colspan>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
        <TableName>VW_STGIDENTRULESCONTRACT</TableName>
        <AliasTableName>vw_tc2</AliasTableName>
        <ColumnRelation>
          <ColumnName>ID_</ColumnName>
          <DataType>string</DataType>
        </ColumnRelation>
        <ColumnSelect>
          <ColumnName>IDENTIFIER</ColumnName>
          <Ressource>IDCONTRACT</Ressource>
          <DataType>string</DataType>
        </ColumnSelect>
        <ColumnLabel>
          <ColumnName>DISPLAYNAME</ColumnName>
          <Ressource>DISPLAYNAME</Ressource>
          <DataType>string</DataType>
        </ColumnLabel>
        <Condition>
          <SQLWhere>
            (TYPECONTRACT = '%%COLUMN_VALUE%%TYPECONTRACT%%')
          </SQLWhere>
        </Condition>
        <AutoComplete enabled="true"/>
      </Relation>
      <!--<Information>
        <Type>information</Type>
        <ToolTipMessage>Msg_IDCONTRACTSTG</ToolTipMessage>
      </Information>-->
    </Column>

    <!-- BLOCK COMMON REFERENCE -->
    
    <Column>
      <ColumnName>COMMONID</ColumnName>
      <Ressource>COMMONID</Ressource>
      <Colspan>3</Colspan>
      <DataType>string</DataType>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default>
        <Value>OrderID</Value>
      </Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
        <DDLType>enum.OrderReferenceEnum</DDLType>
      </Relation>
      <!--<html_HR title="OrderReference"></html_HR>-->
      <Information>
        <Type>information</Type>
        <LabelMessage>Msg_COMMONIDForSTGIDENTRULES</LabelMessage>
        <ToolTipMessage>Msg_COMMONIDForSTGIDENTRULES</ToolTipMessage>        
      </Information>
      <html_BLOCK title="CommonReference_Title"></html_BLOCK>
    </Column>

    <!-- BLOCK ENABLED/DISABLED -->
    <Column>
      <ColumnName>DTENABLED</ColumnName>
      <Ressource>DTENABLED</Ressource>
      <DataType>date</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default>
        <Value>today</Value>
      </Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
      <html_BLOCK title="Status" blockbyrow="2" width="25%" columnbyrow="1"></html_BLOCK>
    </Column>
    <Column>
      <ColumnName>DTDISABLED</ColumnName>
      <Ressource>DTDISABLED</Ressource>
      <DataType>date</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>IDAINS</ColumnName>
      <Ressource>IDAINS</Ressource>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
        <TableName>ACTOR</TableName>
        <AliasTableName>insa</AliasTableName>
        <ColumnRelation>
          <ColumnName>IDA</ColumnName>
          <DataType>int</DataType>
        </ColumnRelation>
        <ColumnSelect>
          <ColumnName>DISPLAYNAME</ColumnName>
          <Ressource>DISPLAYNAME</Ressource>
          <DataType>string</DataType>
        </ColumnSelect>
      </Relation>
    </Column>
    <Column>
      <ColumnName>DTINS</ColumnName>
      <Ressource>DTINS</Ressource>
      <DataType>date</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>IDAUPD</ColumnName>
      <Ressource>IDAUPD</Ressource>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
        <TableName>ACTOR</TableName>
        <AliasTableName>upda</AliasTableName>
        <ColumnRelation>
          <ColumnName>IDA</ColumnName>
          <DataType>int</DataType>
        </ColumnRelation>
        <ColumnSelect>
          <ColumnName>DISPLAYNAME</ColumnName>
          <Ressource>DISPLAYNAME</Ressource>
          <DataType>string</DataType>
        </ColumnSelect>
      </Relation>
    </Column>
    <Column>
      <ColumnName>DTUPD</ColumnName>
      <Ressource>DTUPD</Ressource>
      <DataType>date</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>

    <!-- BLOCK EXTERNAL LINK -->

    <Column>
      <ColumnName>EXTLLINK</ColumnName>
      <Ressource>EXTLLINK</Ressource>
      <DataType>string</DataType>
      <LabelWidth>10%</LabelWidth>
      <Length>128</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
      <html_BLOCK title="ExtlLink_" blockbyrow="2" width="75%" columnbyrow="1"></html_BLOCK>
    </Column>
    <Column>
      <ColumnName>ROWATTRIBUT</ColumnName>
      <Ressource>ROWATTRIBUT</Ressource>
      <DataType>string</DataType>
      <Length>1</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>
    <Column>
      <ColumnName>ROWVERSION</ColumnName>
      <Ressource>ROWVERSION</Ressource>
      <DataType>string</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
      </Relation>
    </Column>

  </Referential>
</Referentials>