<?xml version="1.0" encoding="utf-8" ?>
<!-- FI 20120119 [XXXXX] Mise de IsUseSQLParameters -->
<!-- FI 20140403 [XXXXX] Tuning -->
<!-- FI 20141021 [20350] Add RequestTrack -->
<!-- PM 20150520 [20575] Replace em.DTMARKET with em.DTENTITY-->
<!-- RD 20170104 [22728] Supprimer la condition (tr.POSITIONEFFECT = 'C') pour aligner la requête avec celle du traitement EOD_UpdateEntry-->
<!-- EG 20170315 [22967] Ajouter la colonne GPRODUCT-->
<!-- FI 20170327 [23004] Usage de choose expression-->
<!-- PL 20170405 [23047] Remove TRADE table-->
<!-- EG 20200226 [25077] RDBMS : New version of Trades tables architecture (TRADEINSTRUMENT (INSTRUMENTNO=1) to TRADE)-->
<!-- EG 20230102 [WI500] Refactoring complet de la requête pour ne plus tomber en Timeout (Usage de DTOUT et de clauses With)-->
<!-- EG 20250125 [WI820] Close-outs : Error on Launch Process -->
<Referentials>
  <Referential>
    <IsUseSQLParameters>true</IsUseSQLParameters>
    <TableName>POSKEEPINGENTRY</TableName>
    <AliasTableName>pk</AliasTableName>
    <freezeColumn>9</freezeColumn>
    <Ressource>POSKEEPINGENTRY</Ressource>
    <ColumnByRow>3</ColumnByRow>
    <Create>false</Create>
    <Modify>false</Modify>
    <Remove>false</Remove>
    <Image></Image>
    <Notepad>false</Notepad>
    <Timeout>100</Timeout>

    <SQLSelect>
      <Command rdbms = "all">
        <!-- ATTENTION : Toute modification de cette requête doit être reporté dans le projet NormMsgFactory
                         voir  méthode NormMsgFactory_POSKEEPREQUEST.GetQueryUpdateEntry
        EG 20230102 [WI500] Refactoring complet de la requête pour ne plus tomber en Timeout (Usage de DTOUT et de clauses With)
        -->
        <![CDATA[
        /* SQL: WITHTOMOVE */
        with TRADEOPEN_W as (
	        select 
	        tr.IDT, tr.IDM, tr.IDASSET, tr.SIDE, tr.DTOUT, floor(tr.QTY) as QTY, em.DTENTITY, tr.DTBUSINESS, tr.DTEXECUTION,
	        tr.IDI, em.IDEM, tr.IDA_CSSCUSTODIAN, tr.IDA_ENTITY, tr.IDA_DEALER, tr.IDB_DEALER, tr.IDA_CLEARER, tr.IDB_CLEARER, 'FUT' as GPRODUCT
	        from dbo.TRADE tr
	        inner join VW_INSTR_PRODUCT pr on ( pr.IDI = tr.IDI) and (pr.FUNGIBILITYMODE != 'NONE') and (pr.GPRODUCT = 'FUT')
	        inner join ENTITYMARKET em on ( em.IDM = tr.IDM ) and (em.IDA = tr.IDA_ENTITY) and (em.IDA_CUSTODIAN is null)
	        where (tr.IDSTACTIVATION = 'REGULAR') and (tr.IDSTBUSINESS = 'ALLOC') and (tr.DTOUT is null or tr.DTOUT > em.DTENTITY)
          <choose><when test="{ENTITY}>-1"> and (tr.IDA_ENTITY = @ENTITY)</when></choose>   
          <choose><when test="{MARKET}>-1"> and (tr.IDM = @MARKET)</when></choose> 
          and (%%SR:TRADE_WHERE_PREDICATE%%) 
        ),
        TRADE_W as (
	        select 
	        tr.IDT, tr.IDM, tr.IDASSET, tr.SIDE, tr.DTOUT, floor(tr.QTY) as QTY, em.DTENTITY, tr.DTBUSINESS, tr.DTEXECUTION,
	        tr.IDI, em.IDEM, tr.IDA_CSSCUSTODIAN, tr.IDA_ENTITY, tr.IDA_DEALER, tr.IDB_DEALER, tr.IDA_CLEARER, tr.IDB_CLEARER, 'FUT' as GPRODUCT
	        from dbo.TRADE tr
	        inner join VW_INSTR_PRODUCT pr on ( pr.IDI = tr.IDI) and (pr.FUNGIBILITYMODE != 'NONE') and (pr.GPRODUCT = 'FUT')
	        inner join ENTITYMARKET em on ( em.IDM = tr.IDM ) and (em.IDA = tr.IDA_ENTITY) and (em.IDA_CUSTODIAN is null)
	        where (tr.IDSTACTIVATION = 'REGULAR') and (tr.IDSTBUSINESS = 'ALLOC') and (tr.DTOUT is null or tr.DTOUT > em.DTENTITY) and (tr.DTBUSINESS = em.DTENTITY)
          <choose><when test="{ENTITY}>-1"> and (tr.IDA_ENTITY = @ENTITY)</when></choose>   
          <choose><when test="{MARKET}>-1"> and (tr.IDM = @MARKET)</when></choose>  
          and (%%SR:TRADE_WHERE_PREDICATE%%) 
        ),
        POS_W as (
	        select tw.IDT, tw.IDASSET, tw.DTBUSINESS, tw.QTY, tw.IDI, tw.SIDE, tw.DTEXECUTION, tw.IDM, tw.DTENTITY, tw.IDEM, tw.IDA_CSSCUSTODIAN,
	        tw.IDA_DEALER, tw.IDB_DEALER, tw.IDA_ENTITY, tw.IDA_CLEARER, tw.IDB_CLEARER,  
	        isnull(pos.QTY_SELL,0) as QTY_SELL, isnull(pos.QTY_BUY,0) as QTY_BUY
	        from TRADE_W tw
	        left outer join
	        (
		        select pad.IDT_BUY as IDT, sum(isnull(pad.QTY,0)) as QTY_BUY, 0 as QTY_SELL
		        from TRADE_W alloc 
		        inner join dbo.POSACTIONDET pad on (pad.IDT_BUY = alloc.IDT)
		        inner join dbo.POSACTION pa on (pa.IDPA = pad.IDPA)
		        where (pa.DTOUT is null or pa.DTOUT > alloc.DTENTITY) and (pa.DTBUSINESS <= alloc.DTENTITY) and ((pad.DTCAN is null) or (pad.DTCAN > alloc.DTENTITY))
		        group by pad.IDT_BUY

		        union all

		        select pad.IDT_SELL as IDT, 0 as QTY_BUY, sum(isnull(pad.QTY,0)) as QTY_SELL
		        from TRADE_W alloc 
		        inner join dbo.POSACTIONDET pad on (pad.IDT_SELL = alloc.IDT)
		        inner join dbo.POSACTION pa on (pa.IDPA = pad.IDPA)
		        where (pa.DTOUT is null or pa.DTOUT > alloc.DTENTITY) and (pa.DTBUSINESS <= alloc.DTENTITY) and ((pad.DTCAN is null) or (pad.DTCAN > alloc.DTENTITY))
		        group by pad.IDT_SELL
	        ) pos on (pos.IDT = tw.IDT)
	        where (tw.QTY - isnull(pos.QTY_SELL,0) - isnull(pos.QTY_BUY,0) > 0)
        )
        /* SQL: ENDWITHTOMOVE */
        
        select result.IDT, result.IDA_ENTITY, a_entity.IDENTIFIER as ENTITY_IDENTIFIER, a_entity.DISPLAYNAME as ENTITY_DISPLAYNAME, 
        result.IDA_CSSCUSTODIAN, a_csscust.IDENTIFIER as CSSCUSTODIAN_IDENTIFIER, m.SHORT_ACRONYM as MARKET, result.DTENTITY, result.IDEM, result.IDM, 
        result.IDI, result.IDASSET, result.IDA_DEALER, result.IDB_DEALER, result.IDA_CLEARER, result.IDB_CLEARER,           
        /*--DEALER--*/
        dealer.IDENTIFIER as DEALER_IDENTIFIER,dealer.DISPLAYNAME as DEALER_DISPLAYNAME,
        bdealer.IDENTIFIER as DEALER_BOOKIDENTIFIER,
        case when arCLIENT.IDA is not null then 'Client' else 'House' end as ROLEDEALER,
        /*--CLEARER--*/
        clearer.IDENTIFIER as CLEARER_IDENTIFIER, clearer.DISPLAYNAME as CLEARER_DISPLAYNAME,
        bclearer.IDENTIFIER as CLEARER_BOOKIDENTIFIER,
        /*--TRADE IDENTIFIER--*/
        tr.IDENTIFIER as TRADE_IDENTIFIER,
        /*--CATEGORY--*/
        case asset.CATEGORY when 'F' then 'Future' else 'Option' end as CATEGORY,
        /*--ASSET IDENTIFIER--*/
        asset.IDENTIFIER as ASSET_IDENTIFIER,
        /*--DERIVATIVECONTRACT--*/
        asset.IDDC as ASSET_IDDC, asset.CONTRACTIDENTIFIER, asset.CONTRACTDISPLAYNAME,
        /*--PUTCALL--*/
        case asset.PUTCALL when '0' then 'Put' when '1' then 'Call' else '' end as PUTCALL,
        /*--STRIKE--*/
        asset.STRIKEPRICE as STRIKE,
        /*--MATURITY--*/
        asset.MATFMT_MMMYY, result.GPRODUCT
        from (
        
	        select max(posw.IDT) as IDT, posw.IDM, posw.DTENTITY, posw.IDI, posw.IDASSET, posw.IDEM, posw.IDA_CSSCUSTODIAN, 
          posw.IDA_ENTITY, posw.IDA_DEALER, posw.IDB_DEALER, posw.IDA_CLEARER, posw.IDB_CLEARER, 'FUT' as GPRODUCT
          from POS_W posw
          %%SR:TRADE_JOIN%%(tr.IDT, tr)
          where 
          (posw.QTY - posw.QTY_SELL - posw.QTY_BUY > 0) and
          exists (
	          select 1
	          from TRADEOPEN_W tw
	          left outer join
	          (
		          select pad.IDT_BUY as IDT, sum(isnull(pad.QTY,0)) as QTY_BUY, 0 as QTY_SELL
		          from TRADEOPEN_W alloc 
		          inner join dbo.POSACTIONDET pad on (pad.IDT_BUY = alloc.IDT)
		          inner join dbo.POSACTION pa on (pa.IDPA = pad.IDPA)
		          where (pa.DTOUT is null or pa.DTOUT > alloc.DTENTITY) and (pa.DTBUSINESS <= alloc.DTENTITY) and ((pad.DTCAN is null) or (pad.DTCAN > alloc.DTENTITY))
		          group by pad.IDT_BUY

		          union all

		          select pad.IDT_SELL as IDT, 0 as QTY_BUY, sum(isnull(pad.QTY,0)) as QTY_SELL
		          from TRADEOPEN_W alloc 
		          inner join dbo.POSACTIONDET pad on (pad.IDT_SELL = alloc.IDT)
		          inner join dbo.POSACTION pa on (pa.IDPA = pad.IDPA)
		          where (pa.DTOUT is null or pa.DTOUT > alloc.DTENTITY) and (pa.DTBUSINESS <= alloc.DTENTITY) and ((pad.DTCAN is null) or (pad.DTCAN > alloc.DTENTITY))
		          group by pad.IDT_SELL
	          ) pos on (pos.IDT = tw.IDT)
	          where 
		            (tw.DTBUSINESS <= posw.DTBUSINESS) and 
	              (tw.IDASSET = posw.IDASSET) and 
		            (tw.IDI = posw.IDI) and 
		            (tw.IDA_DEALER = posw.IDA_DEALER) and 
		            (tw.IDB_DEALER = posw.IDB_DEALER) and 
		            (tw.IDA_CLEARER = posw.IDA_CLEARER) and 
		            (tw.IDB_CLEARER = posw.IDB_CLEARER) and 
		            (tw.SIDE <> posw.SIDE) and 
		            (tw.DTEXECUTION <= posw.DTEXECUTION) and
		            (tw.QTY - isnull(pos.QTY_SELL,0) - isnull(pos.QTY_BUY,0) > 0) 
          )
          group by  posw.IDM, posw.DTENTITY, posw.IDI, posw.IDASSET, posw.IDEM, posw.IDA_CSSCUSTODIAN, posw.DTBUSINESS,
                      posw.IDA_DEALER, posw.IDB_DEALER, posw.IDA_ENTITY, 
                      posw.IDA_CLEARER, posw.IDB_CLEARER
          
        ) result
        inner join dbo.ACTOR dealer                on (dealer.IDA = result.IDA_DEALER)
        inner join dbo.BOOK  bdealer               on (bdealer.IDB = result.IDB_DEALER)
        inner join dbo.ACTOR clearer               on (clearer.IDA = result.IDA_CLEARER)
        inner join dbo.BOOK  bclearer              on (bclearer.IDB = result.IDB_CLEARER)
        inner join dbo.VW_ASSET_ETD_EXPANDED asset on (asset.IDASSET = result.IDASSET)
        inner join dbo.VW_MARKET_IDENTIFIER m      on (m.IDM = result.IDM)
        inner join dbo.ACTOR a_entity              on (a_entity.IDA=result.IDA_ENTITY)
        inner join dbo.ACTOR a_csscust             on (a_csscust.IDA=result.IDA_CSSCUSTODIAN)
        inner join dbo.TRADE tr                    on (tr.IDT = result.IDT)
        left outer join (select IDA from dbo.ACTOR where exists (select 1 from dbo.ACTORROLE where IDA=ACTOR.IDA and IDROLEACTOR = 'CLIENT'))  arCLIENT on arCLIENT.IDA=dealer.IDA
      ]]>
      </Command>
    </SQLSelect>

    <!-- ENTITY -->
    <Column>
      <ColumnName>IDA_ENTITY</ColumnName>
      <Ressource>Entity</Ressource>
      <DataType>int</DataType>
      <Nowrap>true</Nowrap>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>
    <Column>
      <ColumnName>ENTITY_IDENTIFIER</ColumnName>
      <Ressource>COL_EntityDealer</Ressource>
      <DataType>string</DataType>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsOrderBy>false</IsOrderBy>
      <IsHyperLink linktype="column" type="IDA" data="IDA_ENTITY" condition="ENTITY" linktable="ACTOR" name="IDENTIFIER">true</IsHyperLink>
    </Column>
    <Column>
      <ColumnName>ENTITY_DISPLAYNAME</ColumnName>
      <Ressource></Ressource>
      <DataType>string</DataType>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsOrderBy>false</IsOrderBy>
      <IsHyperLink linktype="column" type="IDA" data="IDA_ENTITY" condition="ENTITY" linktable="ACTOR" name="DISPLAYNAME">false</IsHyperLink>
    </Column>
    <!-- CLEARING HOUSE -->
    <Column>
      <ColumnName>IDA_CSSCUSTODIAN</ColumnName>
      <Ressource>IDA_CSSCUSTODIAN</Ressource>
      <DataType>int</DataType>
      <Nowrap>true</Nowrap>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>
    <Column>
      <ColumnName>CSSCUSTODIAN_IDENTIFIER</ColumnName>
      <Ressource>CssCustodian</Ressource>
      <DataType>string</DataType>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsOrderBy>false</IsOrderBy>
      <IsHyperLink linktype="column" type="IDA" data="IDA_CSSCUSTODIAN" linktable="ACTOR" condition="CSS|CUSTODIAN" name="IDENTIFIER">true</IsHyperLink>
    </Column>

    <!-- MARKET -->
    <Column>
      <ColumnName>IDM</ColumnName>
      <Ressource>IDAM</Ressource>
      <DataType>int</DataType>
      <Nowrap>true</Nowrap>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>
    <Column>
      <ColumnName>MARKET</ColumnName>
      <Ressource>COL_Market</Ressource>
      <DataType>string</DataType>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsOrderBy>true</IsOrderBy>
      <IsHyperLink linktype="column" type="IDM" data="IDM" linktable="VW_MARKET_IDENTIFIER" name="SHORT_ACRONYM">true</IsHyperLink>
    </Column>

    <!-- DTENTITY -->
    <Column>
      <ColumnName>DTENTITY</ColumnName>
      <Ressource>DTBUSINESS_</Ressource>
      <DataType>date</DataType>
      <Length>8</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>

    <!-- SERIE -->
    <Column>
      <ColumnName>ASSET_IDDC</ColumnName>
      <Ressource></Ressource>
      <DataType>int</DataType>
      <Nowrap>true</Nowrap>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>
    <Column>
      <ColumnName>CONTRACTIDENTIFIER</ColumnName>
      <Ressource>COL_ContractSymbol_</Ressource>
      <DataType>string</DataType>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsOrderBy>true</IsOrderBy>
      <IsHyperLink linktype="column" type="IDDC" data="ASSET_IDDC" linktable="DERIVATIVECONTRACT" name="IDENTIFIER">true</IsHyperLink>
    </Column>
    <Column>
      <ColumnName>CONTRACTDISPLAYNAME</ColumnName>
      <Ressource></Ressource>
      <DataType>string</DataType>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsOrderBy>true</IsOrderBy>
      <IsHyperLink linktype="column" type="IDDC" data="ASSET_IDDC" linktable="DERIVATIVECONTRACT" name="DISPLAYNAME">false</IsHyperLink>
    </Column>
    <Column>
      <ColumnName>IDASSET</ColumnName>
      <Ressource>IDASSET</Ressource>
      <DataType>int</DataType>
      <Colspan>0</Colspan>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>
    <Column>
      <ColumnName>ASSET_IDENTIFIER</ColumnName>
      <Ressource>Asset</Ressource>
      <DataType>string</DataType>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsOrderBy>false</IsOrderBy>
      <IsHyperLink linktype="column" type="IDASSET_ETD" data="IDASSET" linktable="ASSET_ETD" name="IDENTIFIER">true</IsHyperLink>
    </Column>
    <Column>
      <ColumnName>PUTCALL</ColumnName>
      <Ressource>COL_PutCall</Ressource>
      <DataType>string</DataType>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsOrderBy>true</IsOrderBy>
    </Column>
    <Column>
      <ColumnName>MATFMT_MMMYY</ColumnName>
      <Ressource>COL_Maturity_</Ressource>
      <DataType>string</DataType>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsOrderBy>true</IsOrderBy>
      <IsResource>true</IsResource>
    </Column>
    <Column>
      <ColumnName>STRIKE</ColumnName>
      <Ressource>COL_Strike</Ressource>
      <DataType>decimal</DataType>
      <!--<Scale>4</Scale>-->
      <Scale>5</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsOrderBy>true</IsOrderBy>
    </Column>

    <!-- TRADE -->
    <Column>
      <ColumnName>IDT</ColumnName>
      <Ressource>IDT</Ressource>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>

    <Column>
      <ColumnName>TRADE_IDENTIFIER</ColumnName>
      <Ressource>Trade</Ressource>
      <DataType>string</DataType>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsOrderBy>false</IsOrderBy>
      <IsHyperLink linktype="column" type="IDT" data="IDT">true</IsHyperLink>
    </Column>

    <!-- DEALER -->
    <Column>
      <ColumnName>IDA_DEALER</ColumnName>
      <Ressource>COL_Dealer</Ressource>
      <DataType>int</DataType>
      <Nowrap>true</Nowrap>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>
    <Column>
      <ColumnName>IDB_DEALER</ColumnName>
      <DataType>int</DataType>
      <Nowrap>true</Nowrap>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>
    <Column>
      <ColumnName>DEALER_BOOKIDENTIFIER</ColumnName>
      <Ressource>COL_BookDealer</Ressource>
      <DataType>string</DataType>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsOrderBy>true</IsOrderBy>
      <IsHyperLink linktype="column" type="IDB" data="IDB_DEALER" linktable="BOOK" name="IDENTIFIER">true</IsHyperLink>
    </Column>
    <Column>
      <ColumnName>DEALER_IDENTIFIER</ColumnName>
      <Ressource>COL_ActorDealer</Ressource>
      <DataType>string</DataType>
      <Nowrap>true</Nowrap>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInCriteria>false</IsHideInCriteria>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <IsHyperLink linktype="column" type="IDA" data="IDA_DEALER" linktable="ACTOR" name="IDENTIFIER">true</IsHyperLink>
    </Column>
    <Column>
      <ColumnName>DEALER_DISPLAYNAME</ColumnName>
      <DataType>string</DataType>
      <Nowrap>true</Nowrap>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInCriteria>false</IsHideInCriteria>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <IsHyperLink linktype="column" type="IDA" data="IDA_DEALER" linktable="ACTOR" name="DISPLAYNAME">false</IsHyperLink>
    </Column>

    <!-- CLEARER -->
    <Column>
      <ColumnName>IDA_CLEARER</ColumnName>
      <Ressource>COL_Clearer</Ressource>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>
    
    <Column>
      <ColumnName>IDB_CLEARER</ColumnName>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>
    <Column>
      <ColumnName>CLEARER_BOOKIDENTIFIER</ColumnName>
      <Ressource>COL_BookClearer</Ressource>
      <DataType>string</DataType>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsKeyField>false</IsKeyField>
      <IsDataKeyField>false</IsDataKeyField>
      <IsIdentity>false</IsIdentity>
      <IsOrderBy>false</IsOrderBy>
      <IsHyperLink linktype="column" type="IDB" data="IDB_CLEARER" linktable="BOOK" name="IDENTIFIER">true</IsHyperLink>
    </Column>
    <Column>
        <ColumnName>CLEARER_IDENTIFIER</ColumnName>
        <Ressource>Clearing</Ressource>
        <DataType>string</DataType>
        <Nowrap>true</Nowrap>
        <Scale>0</Scale>
        <IsMandatory>false</IsMandatory>
        <RegularExpression></RegularExpression>
        <Default></Default>
        <IsHide>true</IsHide>
        <IsHideInDataGrid>false</IsHideInDataGrid>
        <IsHideInCriteria>true</IsHideInCriteria>
        <IsDataKeyField>false</IsDataKeyField>
        <IsKeyField>false</IsKeyField>
        <IsForeignKeyField>false</IsForeignKeyField>
        <IsIdentity>false</IsIdentity>
        <IsUpdatable>false</IsUpdatable>
        <IsOrderBy>false</IsOrderBy>
        <IsHyperLink linktype="column" type="IDA" data="IDA_CLEARER" condition="CSS|CLEARER" linktable="ACTOR" name="IDENTIFIER">true</IsHyperLink>
      </Column>
    <Column>
      <ColumnName>CLEARER_DISPLAYNAME</ColumnName>
      <DataType>string</DataType>
      <Nowrap>true</Nowrap>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>false</IsHide>
      <IsHideInDataGrid>false</IsHideInDataGrid>
      <IsHideInCriteria>false</IsHideInCriteria>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <IsHyperLink linktype="column" type="IDA" data="IDA_CLEARER" condition="CSS|CLEARER" linktable="ACTOR" name="DISPLAYNAME">false</IsHyperLink>
    </Column>

    <!-- ENTITY CLEARER 
    <Column>
      <ColumnName>IDA_ENTITYCLEARER</ColumnName>
      <Ressource>Entity</Ressource>
      <DataType>int</DataType>
      <Nowrap>true</Nowrap>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>
    -->
    
    <!-- INSTRUMENT -->
    <Column>
      <ColumnName>IDI</ColumnName>
      <Ressource>IDI</Ressource>
      <Colspan>0</Colspan>
      <DataType>int</DataType>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>true</IsMandatory>
      <RegularExpression/>
      <Default/>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation>
        <TableName>INSTRUMENT</TableName>
        <AliasTableName>ns</AliasTableName>
        <ColumnRelation>
          <ColumnName>IDI</ColumnName>
          <DataType>int</DataType>
        </ColumnRelation>
        <ColumnSelect>
          <ColumnName>IDENTIFIER</ColumnName>
          <Ressource>Instrument</Ressource>
          <DataType>string</DataType>
        </ColumnSelect>
        <ColumnLabel>
          <ColumnName>DISPLAYNAME</ColumnName>
          <Ressource>DISPLAYNAME</Ressource>
          <DataType>string</DataType>
        </ColumnLabel>
      </Relation>
    </Column>

    <Column>
      <ColumnName>IDEM</ColumnName>
      <Ressource>IDEM</Ressource>
      <DataType>int</DataType>
      <Nowrap>true</Nowrap>
      <Length>10</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsHideInCriteria>true</IsHideInCriteria>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>false</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
    </Column>

    <Column>
      <ColumnName>GPRODUCT</ColumnName>
      <Ressource>GPRODUCT</Ressource>
      <DataType>string</DataType>
      <Colspan>0</Colspan>
      <Length>64</Length>
      <Scale>0</Scale>
      <IsMandatory>false</IsMandatory>
      <RegularExpression></RegularExpression>
      <Default></Default>
      <IsHide>true</IsHide>
      <IsHideInDataGrid>true</IsHideInDataGrid>
      <IsDataKeyField>false</IsDataKeyField>
      <IsKeyField>false</IsKeyField>
      <IsForeignKeyField>false</IsForeignKeyField>
      <IsIdentity>false</IsIdentity>
      <IsUpdatable>true</IsUpdatable>
      <IsOrderBy>false</IsOrderBy>
      <Relation/>
    </Column>
  </Referential>
</Referentials>

